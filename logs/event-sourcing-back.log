14-02-2023 00:35:00.988 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool.run - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=7h36m37s851ms807µs100ns).
14-02-2023 06:37:40.626 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool.run - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=6h2m44s243ms895µs200ns).
14-02-2023 06:38:02.165 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.service.projection'.
14-02-2023 06:38:02.165 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.service.projection' awaiting termination...
14-02-2023 06:38:02.685 [EmbeddedEventStore-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 06:38:02.685 [EmbeddedEventStore-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
14-02-2023 06:38:02.685 [EmbeddedEventStore-0] ERROR org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.fetchData - Failed to read events from the underlying event storage
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:374)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.list(QuerySqmImpl.java:1073)
	at org.hibernate.query.Query.getResultList(Query.java:94)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchEvents(JpaEventStorageEngine.java:181)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:194)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:70)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:194)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:148)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:289)
	at java.base/java.util.Spliterator.forEachRemaining(Spliterator.java:332)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:261)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:227)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2800(EmbeddedEventStore.java:204)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:148)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.lambda$list$0(JdbcSelectExecutorStandardImpl.java:100)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:171)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.getResultSet(DeferredResultSetAccess.java:146)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.advanceNext(JdbcValuesResultSetImpl.java:205)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.processNext(JdbcValuesResultSetImpl.java:85)
	at org.hibernate.sql.results.jdbc.internal.AbstractJdbcValues.next(AbstractJdbcValues.java:29)
	at org.hibernate.sql.results.internal.RowProcessingStateStandardImpl.next(RowProcessingStateStandardImpl.java:88)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:197)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:33)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:443)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:166)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.list(JdbcSelectExecutorStandardImpl.java:91)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:31)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.lambda$new$0(ConcreteSqmSelectQueryPlan.java:113)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.withCacheableSqmInterpretation(ConcreteSqmSelectQueryPlan.java:335)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.performList(ConcreteSqmSelectQueryPlan.java:276)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doList(QuerySqmImpl.java:571)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:363)
	... 20 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTablePrimary(Parser.java:1863)
	at org.h2.command.Parser.readTableReference(Parser.java:2334)
	at org.h2.command.Parser.parseSelectFromPart(Parser.java:2772)
	at org.h2.command.Parser.parseSelect(Parser.java:2878)
	at org.h2.command.Parser.parseQueryPrimary(Parser.java:2762)
	at org.h2.command.Parser.parseQueryTerm(Parser.java:2633)
	at org.h2.command.Parser.parseQueryExpressionBody(Parser.java:2612)
	at org.h2.command.Parser.parseQueryExpressionBodyAndEndOfQuery(Parser.java:2605)
	at org.h2.command.Parser.parseQueryExpression(Parser.java:2598)
	at org.h2.command.Parser.parseQuery(Parser.java:2567)
	at org.h2.command.Parser.parsePrepared(Parser.java:724)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 39 common frames omitted
14-02-2023 06:38:02.685 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 06:38:02.685 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
14-02-2023 06:38:02.685 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Error occurred. Starting retry mode.
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:175)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:709)
	at org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStore.extendClaim(JpaTokenStore.java:232)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$processBatch$13(TrackingEventProcessor.java:462)
	at org.axonframework.common.transaction.TransactionManager.executeInTransaction(TransactionManager.java:47)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:461)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.lambda$executeUpdate$0(SimpleUpdateQueryPlan.java:99)
	at org.hibernate.sql.exec.internal.StandardJdbcMutationExecutor.execute(StandardJdbcMutationExecutor.java:63)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.executeUpdate(SimpleUpdateQueryPlan.java:93)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doExecuteUpdate(QuerySqmImpl.java:728)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:698)
	... 9 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTableOrView(Parser.java:8328)
	at org.h2.command.Parser.readSimpleTableFilter(Parser.java:1160)
	at org.h2.command.Parser.parseUpdate(Parser.java:1118)
	at org.h2.command.Parser.parsePrepared(Parser.java:858)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 15 common frames omitted
14-02-2023 06:38:02.700 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Releasing claim on token and preparing for retry in 1s
14-02-2023 06:38:02.700 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 06:38:02.700 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 06:38:02.700 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 06:38:02.700 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 06:38:02.700 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 06:38:02.700 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 06:38:02.700 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Worker for segment Segment[0/0] stopped.
14-02-2023 06:38:02.716 [SpringApplicationShutdownHook] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.destroy - Closing JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 06:38:02.716 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown initiated...
14-02-2023 06:38:02.731 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown completed.
14-02-2023 06:38:05.407 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Starting EventSourcingCqrsApplication using Java 17.0.6 with PID 23996 (C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs\target\classes started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 06:38:05.407 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 06:38:05.407 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 06:38:05.475 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 06:38:05.491 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 06:38:05.491 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 06:38:05.491 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 06:38:05.507 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 06:38:06.004 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 06:38:06.067 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 58 ms. Found 1 JPA repository interfaces.
14-02-2023 06:38:06.354 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 06:38:06.543 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize - Tomcat initialized with port(s): 9090 (http)
14-02-2023 06:38:06.543 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Initializing ProtocolHandler ["http-nio-9090"]
14-02-2023 06:38:06.543 [main] INFO  org.apache.catalina.core.StandardService.log - Starting service [Tomcat]
14-02-2023 06:38:06.543 [main] INFO  org.apache.catalina.core.StandardEngine.log - Starting Servlet engine: [Apache Tomcat/10.1.5]
14-02-2023 06:38:06.612 [main] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring embedded WebApplicationContext
14-02-2023 06:38:06.612 [main] INFO  org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.prepareWebApplicationContext - Root WebApplicationContext: initialization completed in 1179 ms
14-02-2023 06:38:06.670 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 06:38:06.744 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 06:38:06.744 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 06:38:06.760 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 06:38:06.862 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 06:38:06.911 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 06:38:07.038 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 06:38:07.137 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 06:38:07.747 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 06:38:07.755 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 06:38:07.778 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 06:38:07.871 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 06:38:07.872 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 06:38:07.872 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 06:38:07.872 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 06:38:07.872 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 06:38:07.874 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 06:38:07.874 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 06:38:07.874 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 06:38:07.874 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 06:38:08.067 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 06:38:08.365 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 06:38:08.423 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Starting ProtocolHandler ["http-nio-9090"]
14-02-2023 06:38:08.437 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.start - Tomcat started on port(s): 9090 (http) with context path ''
14-02-2023 06:38:08.483 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarted - Started EventSourcingCqrsApplication in 3.56 seconds (process running for 4.194)
14-02-2023 06:38:08.739 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.lambda$run$3 - Worker assigned to segment Segment[0/0] for processing
14-02-2023 06:38:08.739 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Using current Thread for last segment worker: TrackingSegmentWorker{processor=com.example.eventsourcingcqrs.service.projection, segment=Segment[0/0]}
14-02-2023 06:38:08.739 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.ensureEventStreamOpened - Fetched token: null for segment: Segment[0/0]
14-02-2023 06:41:03.001 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.service.projection'.
14-02-2023 06:41:03.002 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.service.projection' awaiting termination...
14-02-2023 06:41:03.362 [EmbeddedEventStore-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 06:41:03.362 [EmbeddedEventStore-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
14-02-2023 06:41:03.367 [EmbeddedEventStore-0] ERROR org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.fetchData - Failed to read events from the underlying event storage
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:374)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.list(QuerySqmImpl.java:1073)
	at org.hibernate.query.Query.getResultList(Query.java:94)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchEvents(JpaEventStorageEngine.java:181)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:194)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:70)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:194)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:148)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:289)
	at java.base/java.util.Spliterator.forEachRemaining(Spliterator.java:332)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:261)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:227)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2800(EmbeddedEventStore.java:204)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:148)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.lambda$list$0(JdbcSelectExecutorStandardImpl.java:100)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:171)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.getResultSet(DeferredResultSetAccess.java:146)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.advanceNext(JdbcValuesResultSetImpl.java:205)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.processNext(JdbcValuesResultSetImpl.java:85)
	at org.hibernate.sql.results.jdbc.internal.AbstractJdbcValues.next(AbstractJdbcValues.java:29)
	at org.hibernate.sql.results.internal.RowProcessingStateStandardImpl.next(RowProcessingStateStandardImpl.java:88)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:197)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:33)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:443)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:166)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.list(JdbcSelectExecutorStandardImpl.java:91)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:31)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.lambda$new$0(ConcreteSqmSelectQueryPlan.java:113)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.withCacheableSqmInterpretation(ConcreteSqmSelectQueryPlan.java:335)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.performList(ConcreteSqmSelectQueryPlan.java:276)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doList(QuerySqmImpl.java:571)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:363)
	... 20 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTablePrimary(Parser.java:1863)
	at org.h2.command.Parser.readTableReference(Parser.java:2334)
	at org.h2.command.Parser.parseSelectFromPart(Parser.java:2772)
	at org.h2.command.Parser.parseSelect(Parser.java:2878)
	at org.h2.command.Parser.parseQueryPrimary(Parser.java:2762)
	at org.h2.command.Parser.parseQueryTerm(Parser.java:2633)
	at org.h2.command.Parser.parseQueryExpressionBody(Parser.java:2612)
	at org.h2.command.Parser.parseQueryExpressionBodyAndEndOfQuery(Parser.java:2605)
	at org.h2.command.Parser.parseQueryExpression(Parser.java:2598)
	at org.h2.command.Parser.parseQuery(Parser.java:2567)
	at org.h2.command.Parser.parsePrepared(Parser.java:724)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 39 common frames omitted
14-02-2023 06:41:03.482 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 06:41:03.482 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
14-02-2023 06:41:03.482 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Error occurred. Starting retry mode.
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:175)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:709)
	at org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStore.extendClaim(JpaTokenStore.java:232)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$processBatch$13(TrackingEventProcessor.java:462)
	at org.axonframework.common.transaction.TransactionManager.executeInTransaction(TransactionManager.java:47)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:461)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.lambda$executeUpdate$0(SimpleUpdateQueryPlan.java:99)
	at org.hibernate.sql.exec.internal.StandardJdbcMutationExecutor.execute(StandardJdbcMutationExecutor.java:63)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.executeUpdate(SimpleUpdateQueryPlan.java:93)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doExecuteUpdate(QuerySqmImpl.java:728)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:698)
	... 9 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTableOrView(Parser.java:8328)
	at org.h2.command.Parser.readSimpleTableFilter(Parser.java:1160)
	at org.h2.command.Parser.parseUpdate(Parser.java:1118)
	at org.h2.command.Parser.parsePrepared(Parser.java:858)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 15 common frames omitted
14-02-2023 06:41:03.483 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Releasing claim on token and preparing for retry in 1s
14-02-2023 06:41:03.485 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 06:41:03.485 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 06:41:03.486 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 06:41:03.486 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 06:41:03.486 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 06:41:03.488 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 06:41:03.488 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Worker for segment Segment[0/0] stopped.
14-02-2023 06:41:03.507 [SpringApplicationShutdownHook] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.destroy - Closing JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 06:41:03.509 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown initiated...
14-02-2023 06:41:03.514 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown completed.
14-02-2023 06:41:07.176 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Starting EventSourcingCqrsApplication using Java 17.0.6 with PID 11472 (C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs\target\classes started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 06:41:07.177 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 06:41:07.178 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 06:41:07.251 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 06:41:07.256 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 06:41:07.256 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 06:41:07.258 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 06:41:07.275 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 06:41:07.769 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 06:41:07.835 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 60 ms. Found 1 JPA repository interfaces.
14-02-2023 06:41:08.115 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 06:41:08.288 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize - Tomcat initialized with port(s): 9090 (http)
14-02-2023 06:41:08.294 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Initializing ProtocolHandler ["http-nio-9090"]
14-02-2023 06:41:08.295 [main] INFO  org.apache.catalina.core.StandardService.log - Starting service [Tomcat]
14-02-2023 06:41:08.295 [main] INFO  org.apache.catalina.core.StandardEngine.log - Starting Servlet engine: [Apache Tomcat/10.1.5]
14-02-2023 06:41:08.362 [main] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring embedded WebApplicationContext
14-02-2023 06:41:08.363 [main] INFO  org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.prepareWebApplicationContext - Root WebApplicationContext: initialization completed in 1159 ms
14-02-2023 06:41:08.415 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 06:41:08.482 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 06:41:08.483 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 06:41:08.491 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 06:41:08.573 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 06:41:08.614 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 06:41:08.703 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 06:41:08.783 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 06:41:09.349 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 06:41:09.357 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 06:41:09.392 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 06:41:09.469 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 06:41:09.469 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 06:41:09.469 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 06:41:09.470 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 06:41:09.470 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 06:41:09.475 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 06:41:09.476 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 06:41:09.477 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 06:41:09.477 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 06:41:09.671 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 06:41:09.963 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 06:41:10.020 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Starting ProtocolHandler ["http-nio-9090"]
14-02-2023 06:41:10.034 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.start - Tomcat started on port(s): 9090 (http) with context path ''
14-02-2023 06:41:10.070 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarted - Started EventSourcingCqrsApplication in 3.264 seconds (process running for 3.799)
14-02-2023 06:41:10.319 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.lambda$run$3 - Worker assigned to segment Segment[0/0] for processing
14-02-2023 06:41:10.323 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Using current Thread for last segment worker: TrackingSegmentWorker{processor=com.example.eventsourcingcqrs.service.projection, segment=Segment[0/0]}
14-02-2023 06:41:10.325 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.ensureEventStreamOpened - Fetched token: null for segment: Segment[0/0]
14-02-2023 06:41:51.529 [http-nio-9090-exec-1] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring DispatcherServlet 'dispatcherServlet'
14-02-2023 06:41:51.529 [http-nio-9090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Initializing Servlet 'dispatcherServlet'
14-02-2023 06:41:51.530 [http-nio-9090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Completed initialization in 1 ms
14-02-2023 06:41:51.587 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.<init> - Une commande pour la création d'un nouveau compte bancaire [2f0bdf23-6960-4cb2-88fc-6868bc398434] a été effectué.
14-02-2023 06:41:51.590 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°2f0bdf23-6960-4cb2-88fc-6868bc398434 est en cours...
14-02-2023 06:41:51.592 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°2f0bdf23-6960-4cb2-88fc-6868bc398434 est en cours...
14-02-2023 06:41:51.661 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Création en base du compte n°2f0bdf23-6960-4cb2-88fc-6868bc398434.
14-02-2023 06:41:55.334 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Sauvegarde en base du compte n°2f0bdf23-6960-4cb2-88fc-6868bc398434.
14-02-2023 06:41:55.346 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Activation du compte en cours...
14-02-2023 06:41:55.347 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Compte n°2f0bdf23-6960-4cb2-88fc-6868bc398434 activé, sauvegarde en base du nouveau statut.
14-02-2023 06:43:18.547 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.<init> - Une commande pour la création d'un nouveau compte bancaire [52b6c9cc-7607-4aa8-96b8-ea4e8e9bdb78] a été effectué.
14-02-2023 06:43:18.549 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°52b6c9cc-7607-4aa8-96b8-ea4e8e9bdb78 est en cours...
14-02-2023 06:43:18.549 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°52b6c9cc-7607-4aa8-96b8-ea4e8e9bdb78 est en cours...
14-02-2023 06:43:18.552 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Création en base du compte n°52b6c9cc-7607-4aa8-96b8-ea4e8e9bdb78.
14-02-2023 06:44:04.065 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool.run - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=55s449ms870µs600ns).
14-02-2023 06:44:04.067 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Le compte bancaire n° 52b6c9cc-7607-4aa8-96b8-ea4e8e9bdb78 existe déjà.
14-02-2023 06:44:04.069 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.axonframework.eventhandling.LoggingErrorHandler.onError - EventListener [ProjectionBankAccountService] failed to handle event [f70f74b0-e923-4ff9-8d43-5535c50ccdac] (com.example.eventsourcingcqrs.event.BankAccountCreatedEvent). Continuing processing with next listener
com.example.eventsourcingcqrs.exception.AccountFoundException: Le numéro de compte bancaire 52b6c9cc-7607-4aa8-96b8-ea4e8e9bdb78 existe déjà
	at com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount(ProjectionBankAccountService.java:49)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.axonframework.messaging.annotation.AnnotatedMessageHandlingMember.handle(AnnotatedMessageHandlingMember.java:153)
	at org.axonframework.messaging.annotation.WrappedMessageHandlingMember.handle(WrappedMessageHandlingMember.java:64)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.lambda$handle$1(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.handle(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.messaging.annotation.AnnotatedHandlerInspector$NoMoreInterceptors.handle(AnnotatedHandlerInspector.java:386)
	at org.axonframework.eventhandling.AnnotationEventHandlerAdapter.handle(AnnotationEventHandlerAdapter.java:94)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.invokeHandlers(SimpleEventHandlerInvoker.java:128)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.handle(SimpleEventHandlerInvoker.java:114)
	at org.axonframework.eventhandling.MultiEventHandlerInvoker.handle(MultiEventHandlerInvoker.java:91)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$null$1(AbstractEventProcessor.java:173)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:57)
	at org.axonframework.messaging.interceptors.CorrelationDataInterceptor.handle(CorrelationDataInterceptor.java:67)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$3(TrackingEventProcessor.java:185)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$1(TrackingEventProcessor.java:179)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$processInUnitOfWork$2(AbstractEventProcessor.java:184)
	at org.axonframework.messaging.unitofwork.BatchingUnitOfWork.executeWithResult(BatchingUnitOfWork.java:92)
	at org.axonframework.eventhandling.AbstractEventProcessor.processInUnitOfWork(AbstractEventProcessor.java:166)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:490)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
14-02-2023 06:44:04.074 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Activation du compte en cours...
14-02-2023 06:44:04.075 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Le compte bancaire n° 52b6c9cc-7607-4aa8-96b8-ea4e8e9bdb78 n'existe pas.
14-02-2023 06:44:04.076 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.axonframework.eventhandling.LoggingErrorHandler.onError - EventListener [ProjectionBankAccountService] failed to handle event [cc55fdc2-75d1-4fe9-9ebd-7766e9b50a10] (com.example.eventsourcingcqrs.event.BankAccountActivatedEvent). Continuing processing with next listener
com.example.eventsourcingcqrs.exception.AccountNotFoundException: Le numéro de compte bancaire 52b6c9cc-7607-4aa8-96b8-ea4e8e9bdb78 n'existe pas
	at com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount(ProjectionBankAccountService.java:66)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.axonframework.messaging.annotation.AnnotatedMessageHandlingMember.handle(AnnotatedMessageHandlingMember.java:153)
	at org.axonframework.messaging.annotation.WrappedMessageHandlingMember.handle(WrappedMessageHandlingMember.java:64)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.lambda$handle$1(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.handle(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.messaging.annotation.AnnotatedHandlerInspector$NoMoreInterceptors.handle(AnnotatedHandlerInspector.java:386)
	at org.axonframework.eventhandling.AnnotationEventHandlerAdapter.handle(AnnotationEventHandlerAdapter.java:94)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.invokeHandlers(SimpleEventHandlerInvoker.java:128)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.handle(SimpleEventHandlerInvoker.java:114)
	at org.axonframework.eventhandling.MultiEventHandlerInvoker.handle(MultiEventHandlerInvoker.java:91)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$null$1(AbstractEventProcessor.java:173)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:57)
	at org.axonframework.messaging.interceptors.CorrelationDataInterceptor.handle(CorrelationDataInterceptor.java:67)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$3(TrackingEventProcessor.java:185)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$1(TrackingEventProcessor.java:179)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$processInUnitOfWork$2(AbstractEventProcessor.java:184)
	at org.axonframework.messaging.unitofwork.BatchingUnitOfWork.executeWithResult(BatchingUnitOfWork.java:92)
	at org.axonframework.eventhandling.AbstractEventProcessor.processInUnitOfWork(AbstractEventProcessor.java:166)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:490)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
14-02-2023 06:44:31.339 [http-nio-9090-exec-8] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.<init> - Une commande pour la création d'un nouveau compte bancaire [7678ab23-dc22-4645-a170-7a80be8e5a22] a été effectué.
14-02-2023 06:44:31.340 [http-nio-9090-exec-8] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°7678ab23-dc22-4645-a170-7a80be8e5a22 est en cours...
14-02-2023 06:44:31.340 [http-nio-9090-exec-8] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°7678ab23-dc22-4645-a170-7a80be8e5a22 est en cours...
14-02-2023 06:44:31.343 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Création en base du compte n°7678ab23-dc22-4645-a170-7a80be8e5a22.
14-02-2023 06:45:06.944 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool.run - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1m2s878ms500µs900ns).
14-02-2023 06:45:20.691 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Sauvegarde en base du compte n°7678ab23-dc22-4645-a170-7a80be8e5a22.
14-02-2023 06:45:20.696 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Activation du compte en cours...
14-02-2023 06:45:20.697 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Compte n°7678ab23-dc22-4645-a170-7a80be8e5a22 activé, sauvegarde en base du nouveau statut.
14-02-2023 06:46:05.182 [http-nio-9090-exec-10] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.<init> - Une commande pour la création d'un nouveau compte bancaire [b45ff6cd-7797-49af-8525-d5737287618d] a été effectué.
14-02-2023 06:46:05.182 [http-nio-9090-exec-10] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°b45ff6cd-7797-49af-8525-d5737287618d est en cours...
14-02-2023 06:46:05.182 [http-nio-9090-exec-10] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°b45ff6cd-7797-49af-8525-d5737287618d est en cours...
14-02-2023 06:46:05.186 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Création en base du compte n°b45ff6cd-7797-49af-8525-d5737287618d.
14-02-2023 06:46:24.481 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Le compte bancaire n° b45ff6cd-7797-49af-8525-d5737287618d existe déjà.
14-02-2023 06:46:26.636 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.axonframework.eventhandling.LoggingErrorHandler.onError - EventListener [ProjectionBankAccountService] failed to handle event [33379481-3dc4-47ee-aefa-80a64f6b5923] (com.example.eventsourcingcqrs.event.BankAccountCreatedEvent). Continuing processing with next listener
com.example.eventsourcingcqrs.exception.AccountFoundException: Le numéro de compte bancaire b45ff6cd-7797-49af-8525-d5737287618d existe déjà
	at com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount(ProjectionBankAccountService.java:49)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.axonframework.messaging.annotation.AnnotatedMessageHandlingMember.handle(AnnotatedMessageHandlingMember.java:153)
	at org.axonframework.messaging.annotation.WrappedMessageHandlingMember.handle(WrappedMessageHandlingMember.java:64)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.lambda$handle$1(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.handle(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.messaging.annotation.AnnotatedHandlerInspector$NoMoreInterceptors.handle(AnnotatedHandlerInspector.java:386)
	at org.axonframework.eventhandling.AnnotationEventHandlerAdapter.handle(AnnotationEventHandlerAdapter.java:94)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.invokeHandlers(SimpleEventHandlerInvoker.java:128)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.handle(SimpleEventHandlerInvoker.java:114)
	at org.axonframework.eventhandling.MultiEventHandlerInvoker.handle(MultiEventHandlerInvoker.java:91)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$null$1(AbstractEventProcessor.java:173)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:57)
	at org.axonframework.messaging.interceptors.CorrelationDataInterceptor.handle(CorrelationDataInterceptor.java:67)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$3(TrackingEventProcessor.java:185)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$1(TrackingEventProcessor.java:179)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$processInUnitOfWork$2(AbstractEventProcessor.java:184)
	at org.axonframework.messaging.unitofwork.BatchingUnitOfWork.executeWithResult(BatchingUnitOfWork.java:92)
	at org.axonframework.eventhandling.AbstractEventProcessor.processInUnitOfWork(AbstractEventProcessor.java:166)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:490)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
14-02-2023 06:46:26.639 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Activation du compte en cours...
14-02-2023 06:46:26.639 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Le compte bancaire n° b45ff6cd-7797-49af-8525-d5737287618d n'existe pas.
14-02-2023 06:46:26.640 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.axonframework.eventhandling.LoggingErrorHandler.onError - EventListener [ProjectionBankAccountService] failed to handle event [315e2ef8-c88d-4360-a6c4-6cfbd7806365] (com.example.eventsourcingcqrs.event.BankAccountActivatedEvent). Continuing processing with next listener
com.example.eventsourcingcqrs.exception.AccountNotFoundException: Le numéro de compte bancaire b45ff6cd-7797-49af-8525-d5737287618d n'existe pas
	at com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount(ProjectionBankAccountService.java:66)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.axonframework.messaging.annotation.AnnotatedMessageHandlingMember.handle(AnnotatedMessageHandlingMember.java:153)
	at org.axonframework.messaging.annotation.WrappedMessageHandlingMember.handle(WrappedMessageHandlingMember.java:64)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.lambda$handle$1(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.handle(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.messaging.annotation.AnnotatedHandlerInspector$NoMoreInterceptors.handle(AnnotatedHandlerInspector.java:386)
	at org.axonframework.eventhandling.AnnotationEventHandlerAdapter.handle(AnnotationEventHandlerAdapter.java:94)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.invokeHandlers(SimpleEventHandlerInvoker.java:128)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.handle(SimpleEventHandlerInvoker.java:114)
	at org.axonframework.eventhandling.MultiEventHandlerInvoker.handle(MultiEventHandlerInvoker.java:91)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$null$1(AbstractEventProcessor.java:173)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:57)
	at org.axonframework.messaging.interceptors.CorrelationDataInterceptor.handle(CorrelationDataInterceptor.java:67)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$3(TrackingEventProcessor.java:185)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$1(TrackingEventProcessor.java:179)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$processInUnitOfWork$2(AbstractEventProcessor.java:184)
	at org.axonframework.messaging.unitofwork.BatchingUnitOfWork.executeWithResult(BatchingUnitOfWork.java:92)
	at org.axonframework.eventhandling.AbstractEventProcessor.processInUnitOfWork(AbstractEventProcessor.java:166)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:490)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
14-02-2023 06:47:11.972 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.service.projection'.
14-02-2023 06:47:11.972 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.service.projection' awaiting termination...
14-02-2023 06:47:12.189 [EmbeddedEventStore-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 06:47:12.189 [EmbeddedEventStore-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
14-02-2023 06:47:12.194 [EmbeddedEventStore-0] ERROR org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.fetchData - Failed to read events from the underlying event storage
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:374)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.list(QuerySqmImpl.java:1073)
	at org.hibernate.query.Query.getResultList(Query.java:94)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchEvents(JpaEventStorageEngine.java:181)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:194)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:70)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:194)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:148)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:289)
	at java.base/java.util.Spliterator.forEachRemaining(Spliterator.java:332)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:261)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:227)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2800(EmbeddedEventStore.java:204)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:148)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.lambda$list$0(JdbcSelectExecutorStandardImpl.java:100)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:171)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.getResultSet(DeferredResultSetAccess.java:146)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.advanceNext(JdbcValuesResultSetImpl.java:205)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.processNext(JdbcValuesResultSetImpl.java:85)
	at org.hibernate.sql.results.jdbc.internal.AbstractJdbcValues.next(AbstractJdbcValues.java:29)
	at org.hibernate.sql.results.internal.RowProcessingStateStandardImpl.next(RowProcessingStateStandardImpl.java:88)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:197)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:33)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:443)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:166)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.list(JdbcSelectExecutorStandardImpl.java:91)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:31)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.lambda$new$0(ConcreteSqmSelectQueryPlan.java:113)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.withCacheableSqmInterpretation(ConcreteSqmSelectQueryPlan.java:335)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.performList(ConcreteSqmSelectQueryPlan.java:276)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doList(QuerySqmImpl.java:571)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:363)
	... 20 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTablePrimary(Parser.java:1863)
	at org.h2.command.Parser.readTableReference(Parser.java:2334)
	at org.h2.command.Parser.parseSelectFromPart(Parser.java:2772)
	at org.h2.command.Parser.parseSelect(Parser.java:2878)
	at org.h2.command.Parser.parseQueryPrimary(Parser.java:2762)
	at org.h2.command.Parser.parseQueryTerm(Parser.java:2633)
	at org.h2.command.Parser.parseQueryExpressionBody(Parser.java:2612)
	at org.h2.command.Parser.parseQueryExpressionBodyAndEndOfQuery(Parser.java:2605)
	at org.h2.command.Parser.parseQueryExpression(Parser.java:2598)
	at org.h2.command.Parser.parseQuery(Parser.java:2567)
	at org.h2.command.Parser.parsePrepared(Parser.java:724)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 39 common frames omitted
14-02-2023 06:47:12.195 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 06:47:12.195 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
14-02-2023 06:47:12.195 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Error occurred. Starting retry mode.
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:175)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:709)
	at org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStore.extendClaim(JpaTokenStore.java:232)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$processBatch$13(TrackingEventProcessor.java:462)
	at org.axonframework.common.transaction.TransactionManager.executeInTransaction(TransactionManager.java:47)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:461)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.lambda$executeUpdate$0(SimpleUpdateQueryPlan.java:99)
	at org.hibernate.sql.exec.internal.StandardJdbcMutationExecutor.execute(StandardJdbcMutationExecutor.java:63)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.executeUpdate(SimpleUpdateQueryPlan.java:93)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doExecuteUpdate(QuerySqmImpl.java:728)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:698)
	... 9 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTableOrView(Parser.java:8328)
	at org.h2.command.Parser.readSimpleTableFilter(Parser.java:1160)
	at org.h2.command.Parser.parseUpdate(Parser.java:1118)
	at org.h2.command.Parser.parsePrepared(Parser.java:858)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 15 common frames omitted
14-02-2023 06:47:12.195 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Releasing claim on token and preparing for retry in 1s
14-02-2023 06:47:12.197 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 06:47:12.198 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 06:47:12.198 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 06:47:12.198 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 06:47:12.198 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 06:47:12.199 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 06:47:12.199 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Worker for segment Segment[0/0] stopped.
14-02-2023 06:47:12.217 [SpringApplicationShutdownHook] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.destroy - Closing JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 06:47:12.219 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown initiated...
14-02-2023 06:47:12.232 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown completed.
14-02-2023 06:47:14.987 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Starting EventSourcingCqrsApplication using Java 17.0.6 with PID 12892 (C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs\target\classes started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 06:47:14.989 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 06:47:14.989 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 06:47:15.062 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 06:47:15.068 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 06:47:15.069 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 06:47:15.070 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 06:47:15.084 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 06:47:15.576 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 06:47:15.641 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 60 ms. Found 1 JPA repository interfaces.
14-02-2023 06:47:15.919 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 06:47:16.100 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize - Tomcat initialized with port(s): 9090 (http)
14-02-2023 06:47:16.106 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Initializing ProtocolHandler ["http-nio-9090"]
14-02-2023 06:47:16.106 [main] INFO  org.apache.catalina.core.StandardService.log - Starting service [Tomcat]
14-02-2023 06:47:16.107 [main] INFO  org.apache.catalina.core.StandardEngine.log - Starting Servlet engine: [Apache Tomcat/10.1.5]
14-02-2023 06:47:16.166 [main] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring embedded WebApplicationContext
14-02-2023 06:47:16.167 [main] INFO  org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.prepareWebApplicationContext - Root WebApplicationContext: initialization completed in 1152 ms
14-02-2023 06:47:16.221 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 06:47:16.292 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 06:47:16.294 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 06:47:16.301 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 06:47:16.389 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 06:47:16.428 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 06:47:16.516 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 06:47:16.598 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 06:47:17.162 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 06:47:17.169 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 06:47:17.200 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 06:47:17.283 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 06:47:17.283 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 06:47:17.283 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 06:47:17.284 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 06:47:17.284 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 06:47:17.290 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 06:47:17.291 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 06:47:17.291 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 06:47:17.292 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 06:47:17.493 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 06:47:17.786 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 06:47:17.852 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Starting ProtocolHandler ["http-nio-9090"]
14-02-2023 06:47:17.866 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.start - Tomcat started on port(s): 9090 (http) with context path ''
14-02-2023 06:47:17.903 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarted - Started EventSourcingCqrsApplication in 3.269 seconds (process running for 3.982)
14-02-2023 06:47:18.220 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.lambda$run$3 - Worker assigned to segment Segment[0/0] for processing
14-02-2023 06:47:18.226 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Using current Thread for last segment worker: TrackingSegmentWorker{processor=com.example.eventsourcingcqrs.service.projection, segment=Segment[0/0]}
14-02-2023 06:47:18.229 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.ensureEventStreamOpened - Fetched token: null for segment: Segment[0/0]
14-02-2023 06:47:29.422 [http-nio-9090-exec-10] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring DispatcherServlet 'dispatcherServlet'
14-02-2023 06:47:29.422 [http-nio-9090-exec-10] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Initializing Servlet 'dispatcherServlet'
14-02-2023 06:47:29.424 [http-nio-9090-exec-10] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Completed initialization in 2 ms
14-02-2023 06:47:31.595 [http-nio-9090-exec-10] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.<init> - Une commande pour la création d'un nouveau compte bancaire [9eed46d5-15b0-4e55-b7a8-67d2e1ccd470] a été effectué.
14-02-2023 06:47:31.598 [http-nio-9090-exec-10] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°9eed46d5-15b0-4e55-b7a8-67d2e1ccd470 est en cours...
14-02-2023 06:47:31.600 [http-nio-9090-exec-10] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°9eed46d5-15b0-4e55-b7a8-67d2e1ccd470 est en cours...
14-02-2023 06:47:31.675 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Création en base du compte n°9eed46d5-15b0-4e55-b7a8-67d2e1ccd470.
14-02-2023 06:47:37.304 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Sauvegarde en base du compte n°9eed46d5-15b0-4e55-b7a8-67d2e1ccd470.
14-02-2023 06:47:37.314 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Activation du compte en cours...
14-02-2023 06:47:37.314 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Compte n°9eed46d5-15b0-4e55-b7a8-67d2e1ccd470 activé, sauvegarde en base du nouveau statut.
14-02-2023 06:48:01.732 [http-nio-9090-exec-4] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.<init> - Une commande pour la création d'un nouveau compte bancaire [d6491478-e2ab-4d5b-97a2-81d161a81494] a été effectué.
14-02-2023 06:48:01.733 [http-nio-9090-exec-4] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°d6491478-e2ab-4d5b-97a2-81d161a81494 est en cours...
14-02-2023 06:48:01.733 [http-nio-9090-exec-4] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°d6491478-e2ab-4d5b-97a2-81d161a81494 est en cours...
14-02-2023 06:48:01.740 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Création en base du compte n°d6491478-e2ab-4d5b-97a2-81d161a81494.
14-02-2023 06:48:27.893 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Le compte bancaire n° d6491478-e2ab-4d5b-97a2-81d161a81494 existe déjà.
14-02-2023 06:48:35.418 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.axonframework.eventhandling.LoggingErrorHandler.onError - EventListener [ProjectionBankAccountService] failed to handle event [372219b4-da72-4537-a649-6c72f0dd731d] (com.example.eventsourcingcqrs.event.BankAccountCreatedEvent). Continuing processing with next listener
com.example.eventsourcingcqrs.exception.AccountFoundException: Le numéro de compte bancaire d6491478-e2ab-4d5b-97a2-81d161a81494 existe déjà
	at com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount(ProjectionBankAccountService.java:49)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.axonframework.messaging.annotation.AnnotatedMessageHandlingMember.handle(AnnotatedMessageHandlingMember.java:153)
	at org.axonframework.messaging.annotation.WrappedMessageHandlingMember.handle(WrappedMessageHandlingMember.java:64)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.lambda$handle$1(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.handle(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.messaging.annotation.AnnotatedHandlerInspector$NoMoreInterceptors.handle(AnnotatedHandlerInspector.java:386)
	at org.axonframework.eventhandling.AnnotationEventHandlerAdapter.handle(AnnotationEventHandlerAdapter.java:94)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.invokeHandlers(SimpleEventHandlerInvoker.java:128)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.handle(SimpleEventHandlerInvoker.java:114)
	at org.axonframework.eventhandling.MultiEventHandlerInvoker.handle(MultiEventHandlerInvoker.java:91)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$null$1(AbstractEventProcessor.java:173)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:57)
	at org.axonframework.messaging.interceptors.CorrelationDataInterceptor.handle(CorrelationDataInterceptor.java:67)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$3(TrackingEventProcessor.java:185)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$1(TrackingEventProcessor.java:179)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$processInUnitOfWork$2(AbstractEventProcessor.java:184)
	at org.axonframework.messaging.unitofwork.BatchingUnitOfWork.executeWithResult(BatchingUnitOfWork.java:92)
	at org.axonframework.eventhandling.AbstractEventProcessor.processInUnitOfWork(AbstractEventProcessor.java:166)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:490)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
14-02-2023 06:48:35.423 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Activation du compte en cours...
14-02-2023 06:48:35.423 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Le compte bancaire n° d6491478-e2ab-4d5b-97a2-81d161a81494 n'existe pas.
14-02-2023 06:48:35.424 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.axonframework.eventhandling.LoggingErrorHandler.onError - EventListener [ProjectionBankAccountService] failed to handle event [be6b86f1-6356-4ef4-bb2d-daeba20520e8] (com.example.eventsourcingcqrs.event.BankAccountActivatedEvent). Continuing processing with next listener
com.example.eventsourcingcqrs.exception.AccountNotFoundException: Le numéro de compte bancaire d6491478-e2ab-4d5b-97a2-81d161a81494 n'existe pas
	at com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount(ProjectionBankAccountService.java:66)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.axonframework.messaging.annotation.AnnotatedMessageHandlingMember.handle(AnnotatedMessageHandlingMember.java:153)
	at org.axonframework.messaging.annotation.WrappedMessageHandlingMember.handle(WrappedMessageHandlingMember.java:64)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.lambda$handle$1(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.handle(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.messaging.annotation.AnnotatedHandlerInspector$NoMoreInterceptors.handle(AnnotatedHandlerInspector.java:386)
	at org.axonframework.eventhandling.AnnotationEventHandlerAdapter.handle(AnnotationEventHandlerAdapter.java:94)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.invokeHandlers(SimpleEventHandlerInvoker.java:128)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.handle(SimpleEventHandlerInvoker.java:114)
	at org.axonframework.eventhandling.MultiEventHandlerInvoker.handle(MultiEventHandlerInvoker.java:91)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$null$1(AbstractEventProcessor.java:173)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:57)
	at org.axonframework.messaging.interceptors.CorrelationDataInterceptor.handle(CorrelationDataInterceptor.java:67)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$3(TrackingEventProcessor.java:185)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$1(TrackingEventProcessor.java:179)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$processInUnitOfWork$2(AbstractEventProcessor.java:184)
	at org.axonframework.messaging.unitofwork.BatchingUnitOfWork.executeWithResult(BatchingUnitOfWork.java:92)
	at org.axonframework.eventhandling.AbstractEventProcessor.processInUnitOfWork(AbstractEventProcessor.java:166)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:490)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
14-02-2023 07:09:06.167 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool.run - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=5m19s484ms400µs900ns).
14-02-2023 07:09:18.421 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.service.projection'.
14-02-2023 07:09:18.422 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.service.projection' awaiting termination...
14-02-2023 07:09:18.555 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 90121, SQLState: 90121
14-02-2023 07:09:18.555 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - La base de données est déjà fermée (pour désactiver la fermeture automatique à l'arrêt de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE" à l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
14-02-2023 07:09:18.557 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.springframework.orm.jpa.EntityManagerFactoryUtils.closeEntityManager - Failed to release JPA EntityManager
org.hibernate.exception.JDBCConnectionException: Unable to release JDBC Connection
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:49)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:95)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.releaseConnection(LogicalConnectionManagedImpl.java:222)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.close(LogicalConnectionManagedImpl.java:252)
	at org.hibernate.engine.jdbc.internal.JdbcCoordinatorImpl.close(JdbcCoordinatorImpl.java:170)
	at org.hibernate.internal.AbstractSharedSessionContract.close(AbstractSharedSessionContract.java:376)
	at org.hibernate.internal.SessionImpl.closeWithoutOpenChecks(SessionImpl.java:404)
	at org.hibernate.internal.SessionImpl.close(SessionImpl.java:389)
	at org.springframework.orm.jpa.EntityManagerFactoryUtils.closeEntityManager(EntityManagerFactoryUtils.java:424)
	at org.springframework.orm.jpa.JpaTransactionManager.closeEntityManagerAfterFailedBegin(JpaTransactionManager.java:514)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:466)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:400)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:373)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager.startTransaction(SpringTransactionManager.java:65)
	at org.axonframework.common.transaction.TransactionManager.executeInTransaction(TransactionManager.java:45)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:461)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.h2.jdbc.JdbcSQLNonTransientConnectionException: La base de données est déjà fermée (pour désactiver la fermeture automatique à l'arrêt de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE" à l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:678)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.get(DbException.java:188)
	at org.h2.jdbc.JdbcConnection.checkClosed(JdbcConnection.java:1375)
	at org.h2.jdbc.JdbcConnection.clearWarnings(JdbcConnection.java:610)
	at com.zaxxer.hikari.pool.ProxyConnection.close(ProxyConnection.java:257)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.closeConnection(DatasourceConnectionProviderImpl.java:127)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.releaseConnection(NonContextualJdbcConnectionAccess.java:49)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.releaseConnection(LogicalConnectionManagedImpl.java:218)
	... 18 common frames omitted
14-02-2023 07:09:18.558 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Error occurred. Starting retry mode.
org.springframework.transaction.CannotCreateTransactionException: Could not open JPA EntityManager for transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:467)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:400)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:373)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager.startTransaction(SpringTransactionManager.java:65)
	at org.axonframework.common.transaction.TransactionManager.executeInTransaction(TransactionManager.java:45)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:461)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.TransactionException: JDBC begin transaction failed:
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.begin(AbstractLogicalConnectionImplementor.java:78)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.begin(LogicalConnectionManagedImpl.java:276)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.begin(JdbcResourceLocalTransactionCoordinatorImpl.java:246)
	at org.hibernate.engine.transaction.internal.TransactionImpl.begin(TransactionImpl.java:83)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.beginTransaction(HibernateJpaDialect.java:164)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:421)
	... 10 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLNonTransientConnectionException: La base de données est déjà fermée (pour désactiver la fermeture automatique à l'arrêt de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE" à l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:678)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.get(DbException.java:188)
	at org.h2.jdbc.JdbcConnection.checkClosed(JdbcConnection.java:1375)
	at org.h2.jdbc.JdbcConnection.setAutoCommit(JdbcConnection.java:402)
	at com.zaxxer.hikari.pool.ProxyConnection.setAutoCommit(ProxyConnection.java:401)
	at com.zaxxer.hikari.pool.HikariProxyConnection.setAutoCommit(HikariProxyConnection.java)
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.begin(AbstractLogicalConnectionImplementor.java:72)
	... 15 common frames omitted
14-02-2023 07:09:18.559 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Releasing claim on token and preparing for retry in 1s
14-02-2023 07:09:18.560 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 90121, SQLState: 90121
14-02-2023 07:09:18.561 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - La base de données est déjà fermée (pour désactiver la fermeture automatique à l'arrêt de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE" à l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
14-02-2023 07:09:18.561 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.springframework.orm.jpa.EntityManagerFactoryUtils.closeEntityManager - Failed to release JPA EntityManager
org.hibernate.exception.JDBCConnectionException: Unable to release JDBC Connection
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:49)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:95)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.releaseConnection(LogicalConnectionManagedImpl.java:222)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.close(LogicalConnectionManagedImpl.java:252)
	at org.hibernate.engine.jdbc.internal.JdbcCoordinatorImpl.close(JdbcCoordinatorImpl.java:170)
	at org.hibernate.internal.AbstractSharedSessionContract.close(AbstractSharedSessionContract.java:376)
	at org.hibernate.internal.SessionImpl.closeWithoutOpenChecks(SessionImpl.java:404)
	at org.hibernate.internal.SessionImpl.close(SessionImpl.java:389)
	at org.springframework.orm.jpa.EntityManagerFactoryUtils.closeEntityManager(EntityManagerFactoryUtils.java:424)
	at org.springframework.orm.jpa.JpaTransactionManager.closeEntityManagerAfterFailedBegin(JpaTransactionManager.java:514)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:466)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:400)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:373)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager.startTransaction(SpringTransactionManager.java:65)
	at org.axonframework.common.transaction.TransactionManager.executeInTransaction(TransactionManager.java:45)
	at org.axonframework.eventhandling.TrackingEventProcessor.releaseToken(TrackingEventProcessor.java:372)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:345)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.h2.jdbc.JdbcSQLNonTransientConnectionException: La base de données est déjà fermée (pour désactiver la fermeture automatique à l'arrêt de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE" à l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:678)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.get(DbException.java:188)
	at org.h2.jdbc.JdbcConnection.checkClosed(JdbcConnection.java:1375)
	at org.h2.jdbc.JdbcConnection.clearWarnings(JdbcConnection.java:610)
	at com.zaxxer.hikari.pool.ProxyConnection.close(ProxyConnection.java:257)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.closeConnection(DatasourceConnectionProviderImpl.java:127)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.releaseConnection(NonContextualJdbcConnectionAccess.java:49)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.releaseConnection(LogicalConnectionManagedImpl.java:218)
	... 18 common frames omitted
14-02-2023 07:09:18.561 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 07:09:18.563 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 90121, SQLState: 90121
14-02-2023 07:09:18.563 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - La base de données est déjà fermée (pour désactiver la fermeture automatique à l'arrêt de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE" à l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
14-02-2023 07:09:18.563 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.springframework.orm.jpa.EntityManagerFactoryUtils.closeEntityManager - Failed to release JPA EntityManager
org.hibernate.exception.JDBCConnectionException: Unable to release JDBC Connection
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:49)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:95)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.releaseConnection(LogicalConnectionManagedImpl.java:222)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.close(LogicalConnectionManagedImpl.java:252)
	at org.hibernate.engine.jdbc.internal.JdbcCoordinatorImpl.close(JdbcCoordinatorImpl.java:170)
	at org.hibernate.internal.AbstractSharedSessionContract.close(AbstractSharedSessionContract.java:376)
	at org.hibernate.internal.SessionImpl.closeWithoutOpenChecks(SessionImpl.java:404)
	at org.hibernate.internal.SessionImpl.close(SessionImpl.java:389)
	at org.springframework.orm.jpa.EntityManagerFactoryUtils.closeEntityManager(EntityManagerFactoryUtils.java:424)
	at org.springframework.orm.jpa.JpaTransactionManager.closeEntityManagerAfterFailedBegin(JpaTransactionManager.java:514)
	at org.springframework.orm.jpa.JpaTransactionManager.doBegin(JpaTransactionManager.java:466)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.startTransaction(AbstractPlatformTransactionManager.java:400)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:373)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager.startTransaction(SpringTransactionManager.java:65)
	at org.axonframework.common.transaction.TransactionManager.executeInTransaction(TransactionManager.java:45)
	at org.axonframework.eventhandling.TrackingEventProcessor.releaseToken(TrackingEventProcessor.java:372)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:354)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.h2.jdbc.JdbcSQLNonTransientConnectionException: La base de données est déjà fermée (pour désactiver la fermeture automatique à l'arrêt de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE" à l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:678)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.get(DbException.java:188)
	at org.h2.jdbc.JdbcConnection.checkClosed(JdbcConnection.java:1375)
	at org.h2.jdbc.JdbcConnection.clearWarnings(JdbcConnection.java:610)
	at com.zaxxer.hikari.pool.ProxyConnection.close(ProxyConnection.java:257)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.closeConnection(DatasourceConnectionProviderImpl.java:127)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.releaseConnection(NonContextualJdbcConnectionAccess.java:49)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.releaseConnection(LogicalConnectionManagedImpl.java:218)
	... 18 common frames omitted
14-02-2023 07:09:18.563 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 07:09:18.564 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Worker for segment Segment[0/0] stopped.
14-02-2023 07:11:04.167 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Starting EventSourcingCqrsApplication using Java 17.0.6 with PID 12396 (C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs\target\classes started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 07:11:04.168 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 07:11:04.169 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 07:11:04.241 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 07:11:04.246 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 07:11:04.247 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 07:11:04.249 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 07:11:04.265 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 07:11:04.747 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 07:11:04.810 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 57 ms. Found 1 JPA repository interfaces.
14-02-2023 07:11:05.092 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 07:11:05.276 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize - Tomcat initialized with port(s): 9090 (http)
14-02-2023 07:11:05.282 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Initializing ProtocolHandler ["http-nio-9090"]
14-02-2023 07:11:05.282 [main] INFO  org.apache.catalina.core.StandardService.log - Starting service [Tomcat]
14-02-2023 07:11:05.283 [main] INFO  org.apache.catalina.core.StandardEngine.log - Starting Servlet engine: [Apache Tomcat/10.1.5]
14-02-2023 07:11:05.344 [main] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring embedded WebApplicationContext
14-02-2023 07:11:05.345 [main] INFO  org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.prepareWebApplicationContext - Root WebApplicationContext: initialization completed in 1150 ms
14-02-2023 07:11:05.397 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 07:11:05.466 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 07:11:05.468 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 07:11:05.475 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 07:11:05.563 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 07:11:05.603 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 07:11:05.693 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 07:11:05.778 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 07:11:06.376 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 07:11:06.387 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 07:11:06.445 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 07:11:06.591 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 07:11:06.591 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 07:11:06.592 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 07:11:06.592 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 07:11:06.592 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 07:11:06.601 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 07:11:06.602 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 07:11:06.603 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 07:11:06.603 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 07:11:06.823 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 07:11:07.207 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 07:11:07.272 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Starting ProtocolHandler ["http-nio-9090"]
14-02-2023 07:11:07.293 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.start - Tomcat started on port(s): 9090 (http) with context path ''
14-02-2023 07:11:07.337 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarted - Started EventSourcingCqrsApplication in 3.525 seconds (process running for 4.044)
14-02-2023 07:11:07.597 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.lambda$run$3 - Worker assigned to segment Segment[0/0] for processing
14-02-2023 07:11:07.602 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Using current Thread for last segment worker: TrackingSegmentWorker{processor=com.example.eventsourcingcqrs.service.projection, segment=Segment[0/0]}
14-02-2023 07:11:07.604 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.ensureEventStreamOpened - Fetched token: null for segment: Segment[0/0]
14-02-2023 07:11:23.760 [http-nio-9090-exec-2] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring DispatcherServlet 'dispatcherServlet'
14-02-2023 07:11:23.760 [http-nio-9090-exec-2] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Initializing Servlet 'dispatcherServlet'
14-02-2023 07:11:23.762 [http-nio-9090-exec-2] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Completed initialization in 2 ms
14-02-2023 07:11:26.007 [http-nio-9090-exec-2] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.<init> - Une commande pour la création d'un nouveau compte bancaire [7d1cf1ca-a017-45e0-9325-d7b57978859b] a été effectué.
14-02-2023 07:11:26.010 [http-nio-9090-exec-2] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°7d1cf1ca-a017-45e0-9325-d7b57978859b est en cours...
14-02-2023 07:11:26.013 [http-nio-9090-exec-2] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°7d1cf1ca-a017-45e0-9325-d7b57978859b est en cours...
14-02-2023 07:11:26.083 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Création en base du compte n°7d1cf1ca-a017-45e0-9325-d7b57978859b.
14-02-2023 07:11:34.144 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Sauvegarde en base du compte n°7d1cf1ca-a017-45e0-9325-d7b57978859b.
14-02-2023 07:11:34.144 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Activation du compte en cours...
14-02-2023 07:11:34.160 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Compte n°7d1cf1ca-a017-45e0-9325-d7b57978859b activé, sauvegarde en base du nouveau statut.
14-02-2023 07:11:40.656 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.<init> - Une commande pour la création d'un nouveau compte bancaire [2563c2b3-f4fb-47e6-95a1-594b46cba3b5] a été effectué.
14-02-2023 07:11:40.656 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°2563c2b3-f4fb-47e6-95a1-594b46cba3b5 est en cours...
14-02-2023 07:11:40.657 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°2563c2b3-f4fb-47e6-95a1-594b46cba3b5 est en cours...
14-02-2023 07:11:40.664 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Création en base du compte n°2563c2b3-f4fb-47e6-95a1-594b46cba3b5.
14-02-2023 07:11:52.121 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Le compte bancaire n° 2563c2b3-f4fb-47e6-95a1-594b46cba3b5 existe déjà.
14-02-2023 07:11:59.657 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.axonframework.eventhandling.LoggingErrorHandler.onError - EventListener [ProjectionBankAccountService] failed to handle event [184c295c-c977-4a6d-b6bc-ac9a83ae6cfe] (com.example.eventsourcingcqrs.event.BankAccountCreatedEvent). Continuing processing with next listener
com.example.eventsourcingcqrs.exception.AccountFoundException: Le numéro de compte bancaire 2563c2b3-f4fb-47e6-95a1-594b46cba3b5 existe déjà
	at com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount(ProjectionBankAccountService.java:49)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.axonframework.messaging.annotation.AnnotatedMessageHandlingMember.handle(AnnotatedMessageHandlingMember.java:153)
	at org.axonframework.messaging.annotation.WrappedMessageHandlingMember.handle(WrappedMessageHandlingMember.java:64)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.lambda$handle$1(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.handle(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.messaging.annotation.AnnotatedHandlerInspector$NoMoreInterceptors.handle(AnnotatedHandlerInspector.java:386)
	at org.axonframework.eventhandling.AnnotationEventHandlerAdapter.handle(AnnotationEventHandlerAdapter.java:94)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.invokeHandlers(SimpleEventHandlerInvoker.java:128)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.handle(SimpleEventHandlerInvoker.java:114)
	at org.axonframework.eventhandling.MultiEventHandlerInvoker.handle(MultiEventHandlerInvoker.java:91)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$null$1(AbstractEventProcessor.java:173)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:57)
	at org.axonframework.messaging.interceptors.CorrelationDataInterceptor.handle(CorrelationDataInterceptor.java:67)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$3(TrackingEventProcessor.java:185)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$1(TrackingEventProcessor.java:179)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$processInUnitOfWork$2(AbstractEventProcessor.java:184)
	at org.axonframework.messaging.unitofwork.BatchingUnitOfWork.executeWithResult(BatchingUnitOfWork.java:92)
	at org.axonframework.eventhandling.AbstractEventProcessor.processInUnitOfWork(AbstractEventProcessor.java:166)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:490)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
14-02-2023 07:11:59.673 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Activation du compte en cours...
14-02-2023 07:11:59.673 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Le compte bancaire n° 2563c2b3-f4fb-47e6-95a1-594b46cba3b5 n'existe pas.
14-02-2023 07:11:59.673 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.axonframework.eventhandling.LoggingErrorHandler.onError - EventListener [ProjectionBankAccountService] failed to handle event [7ade25ca-790f-453a-8c9f-7ab932d20644] (com.example.eventsourcingcqrs.event.BankAccountActivatedEvent). Continuing processing with next listener
com.example.eventsourcingcqrs.exception.AccountNotFoundException: Le numéro de compte bancaire 2563c2b3-f4fb-47e6-95a1-594b46cba3b5 n'existe pas
	at com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount(ProjectionBankAccountService.java:66)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.axonframework.messaging.annotation.AnnotatedMessageHandlingMember.handle(AnnotatedMessageHandlingMember.java:153)
	at org.axonframework.messaging.annotation.WrappedMessageHandlingMember.handle(WrappedMessageHandlingMember.java:64)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.lambda$handle$1(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.handle(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.messaging.annotation.AnnotatedHandlerInspector$NoMoreInterceptors.handle(AnnotatedHandlerInspector.java:386)
	at org.axonframework.eventhandling.AnnotationEventHandlerAdapter.handle(AnnotationEventHandlerAdapter.java:94)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.invokeHandlers(SimpleEventHandlerInvoker.java:128)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.handle(SimpleEventHandlerInvoker.java:114)
	at org.axonframework.eventhandling.MultiEventHandlerInvoker.handle(MultiEventHandlerInvoker.java:91)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$null$1(AbstractEventProcessor.java:173)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:57)
	at org.axonframework.messaging.interceptors.CorrelationDataInterceptor.handle(CorrelationDataInterceptor.java:67)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$3(TrackingEventProcessor.java:185)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$1(TrackingEventProcessor.java:179)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$processInUnitOfWork$2(AbstractEventProcessor.java:184)
	at org.axonframework.messaging.unitofwork.BatchingUnitOfWork.executeWithResult(BatchingUnitOfWork.java:92)
	at org.axonframework.eventhandling.AbstractEventProcessor.processInUnitOfWork(AbstractEventProcessor.java:166)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:490)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
14-02-2023 07:13:32.710 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.service.projection'.
14-02-2023 07:13:32.710 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.service.projection' awaiting termination...
14-02-2023 07:13:33.486 [EmbeddedEventStore-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 07:13:33.486 [EmbeddedEventStore-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
14-02-2023 07:13:33.498 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 07:13:33.498 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
14-02-2023 07:13:33.503 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Error occurred. Starting retry mode.
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:175)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:709)
	at org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStore.extendClaim(JpaTokenStore.java:232)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$processBatch$13(TrackingEventProcessor.java:462)
	at org.axonframework.common.transaction.TransactionManager.executeInTransaction(TransactionManager.java:47)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:461)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.lambda$executeUpdate$0(SimpleUpdateQueryPlan.java:99)
	at org.hibernate.sql.exec.internal.StandardJdbcMutationExecutor.execute(StandardJdbcMutationExecutor.java:63)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.executeUpdate(SimpleUpdateQueryPlan.java:93)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doExecuteUpdate(QuerySqmImpl.java:728)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:698)
	... 9 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTableOrView(Parser.java:8328)
	at org.h2.command.Parser.readSimpleTableFilter(Parser.java:1160)
	at org.h2.command.Parser.parseUpdate(Parser.java:1118)
	at org.h2.command.Parser.parsePrepared(Parser.java:858)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 15 common frames omitted
14-02-2023 07:13:33.503 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Releasing claim on token and preparing for retry in 1s
14-02-2023 07:13:33.503 [EmbeddedEventStore-0] ERROR org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.fetchData - Failed to read events from the underlying event storage
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:374)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.list(QuerySqmImpl.java:1073)
	at org.hibernate.query.Query.getResultList(Query.java:94)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchEvents(JpaEventStorageEngine.java:181)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:194)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:70)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:194)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:148)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:289)
	at java.base/java.util.Spliterator.forEachRemaining(Spliterator.java:332)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:261)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:227)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2800(EmbeddedEventStore.java:204)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:148)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.lambda$list$0(JdbcSelectExecutorStandardImpl.java:100)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:171)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.getResultSet(DeferredResultSetAccess.java:146)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.advanceNext(JdbcValuesResultSetImpl.java:205)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.processNext(JdbcValuesResultSetImpl.java:85)
	at org.hibernate.sql.results.jdbc.internal.AbstractJdbcValues.next(AbstractJdbcValues.java:29)
	at org.hibernate.sql.results.internal.RowProcessingStateStandardImpl.next(RowProcessingStateStandardImpl.java:88)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:197)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:33)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:443)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:166)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.list(JdbcSelectExecutorStandardImpl.java:91)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:31)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.lambda$new$0(ConcreteSqmSelectQueryPlan.java:113)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.withCacheableSqmInterpretation(ConcreteSqmSelectQueryPlan.java:335)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.performList(ConcreteSqmSelectQueryPlan.java:276)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doList(QuerySqmImpl.java:571)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:363)
	... 20 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTablePrimary(Parser.java:1863)
	at org.h2.command.Parser.readTableReference(Parser.java:2334)
	at org.h2.command.Parser.parseSelectFromPart(Parser.java:2772)
	at org.h2.command.Parser.parseSelect(Parser.java:2878)
	at org.h2.command.Parser.parseQueryPrimary(Parser.java:2762)
	at org.h2.command.Parser.parseQueryTerm(Parser.java:2633)
	at org.h2.command.Parser.parseQueryExpressionBody(Parser.java:2612)
	at org.h2.command.Parser.parseQueryExpressionBodyAndEndOfQuery(Parser.java:2605)
	at org.h2.command.Parser.parseQueryExpression(Parser.java:2598)
	at org.h2.command.Parser.parseQuery(Parser.java:2567)
	at org.h2.command.Parser.parsePrepared(Parser.java:724)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 39 common frames omitted
14-02-2023 07:13:33.503 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 07:13:33.503 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 07:13:33.503 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 07:13:33.503 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 07:13:33.503 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 07:13:33.503 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 07:13:33.503 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Worker for segment Segment[0/0] stopped.
14-02-2023 07:13:33.519 [SpringApplicationShutdownHook] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.destroy - Closing JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 07:13:33.519 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown initiated...
14-02-2023 07:13:33.535 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown completed.
14-02-2023 07:13:37.421 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Starting EventSourcingCqrsApplication using Java 17.0.6 with PID 10732 (C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs\target\classes started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 07:13:37.421 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 07:13:37.421 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 07:13:37.492 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 07:13:37.505 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 07:13:37.505 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 07:13:37.505 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 07:13:37.520 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 07:13:37.995 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 07:13:38.073 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 60 ms. Found 1 JPA repository interfaces.
14-02-2023 07:13:38.345 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 07:13:38.517 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize - Tomcat initialized with port(s): 9090 (http)
14-02-2023 07:13:38.517 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Initializing ProtocolHandler ["http-nio-9090"]
14-02-2023 07:13:38.517 [main] INFO  org.apache.catalina.core.StandardService.log - Starting service [Tomcat]
14-02-2023 07:13:38.517 [main] INFO  org.apache.catalina.core.StandardEngine.log - Starting Servlet engine: [Apache Tomcat/10.1.5]
14-02-2023 07:13:38.580 [main] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring embedded WebApplicationContext
14-02-2023 07:13:38.580 [main] INFO  org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.prepareWebApplicationContext - Root WebApplicationContext: initialization completed in 1129 ms
14-02-2023 07:13:38.627 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 07:13:38.706 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 07:13:38.706 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 07:13:38.706 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 07:13:38.795 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 07:13:38.831 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 07:13:38.931 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 07:13:38.997 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 07:13:39.566 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 07:13:39.572 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 07:13:39.605 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 07:13:39.687 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 07:13:39.687 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 07:13:39.688 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 07:13:39.688 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 07:13:39.688 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 07:13:39.693 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 07:13:39.694 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 07:13:39.694 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 07:13:39.694 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 07:13:39.901 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 07:13:40.194 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 07:13:40.241 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Starting ProtocolHandler ["http-nio-9090"]
14-02-2023 07:13:40.257 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.start - Tomcat started on port(s): 9090 (http) with context path ''
14-02-2023 07:13:40.297 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarted - Started EventSourcingCqrsApplication in 3.289 seconds (process running for 3.939)
14-02-2023 07:13:40.534 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.lambda$run$3 - Worker assigned to segment Segment[0/0] for processing
14-02-2023 07:13:40.534 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Using current Thread for last segment worker: TrackingSegmentWorker{processor=com.example.eventsourcingcqrs.service.projection, segment=Segment[0/0]}
14-02-2023 07:13:40.534 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.ensureEventStreamOpened - Fetched token: null for segment: Segment[0/0]
14-02-2023 07:13:43.060 [http-nio-9090-exec-1] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring DispatcherServlet 'dispatcherServlet'
14-02-2023 07:13:43.060 [http-nio-9090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Initializing Servlet 'dispatcherServlet'
14-02-2023 07:13:43.061 [http-nio-9090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Completed initialization in 1 ms
14-02-2023 07:13:45.251 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.<init> - Une commande pour la création d'un nouveau compte bancaire [6a08a0b9-cb39-4389-ad81-cc1c0cb804f0] a été effectué.
14-02-2023 07:13:45.258 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°6a08a0b9-cb39-4389-ad81-cc1c0cb804f0 est en cours...
14-02-2023 07:13:45.261 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°6a08a0b9-cb39-4389-ad81-cc1c0cb804f0 est en cours...
14-02-2023 07:13:45.334 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Création en base du compte n°6a08a0b9-cb39-4389-ad81-cc1c0cb804f0.
14-02-2023 07:13:46.017 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Sauvegarde en base du compte n°6a08a0b9-cb39-4389-ad81-cc1c0cb804f0.
14-02-2023 07:13:46.017 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Activation du compte en cours...
14-02-2023 07:13:46.465 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Compte n°6a08a0b9-cb39-4389-ad81-cc1c0cb804f0 activé, sauvegarde en base du nouveau statut.
14-02-2023 07:13:58.106 [http-nio-9090-exec-2] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.<init> - Une commande pour la création d'un nouveau compte bancaire [52b224a8-3873-4eaf-9627-e6dc79685918] a été effectué.
14-02-2023 07:13:58.107 [http-nio-9090-exec-2] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°52b224a8-3873-4eaf-9627-e6dc79685918 est en cours...
14-02-2023 07:13:58.107 [http-nio-9090-exec-2] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°52b224a8-3873-4eaf-9627-e6dc79685918 est en cours...
14-02-2023 07:13:58.112 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Création en base du compte n°52b224a8-3873-4eaf-9627-e6dc79685918.
14-02-2023 07:14:08.658 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Le compte bancaire n° 52b224a8-3873-4eaf-9627-e6dc79685918 existe déjà.
14-02-2023 07:14:08.658 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.axonframework.eventhandling.LoggingErrorHandler.onError - EventListener [ProjectionBankAccountService] failed to handle event [0f271294-21a6-4bea-a071-d4a6aa717996] (com.example.eventsourcingcqrs.event.BankAccountCreatedEvent). Continuing processing with next listener
com.example.eventsourcingcqrs.exception.AccountFoundException: Le numéro de compte bancaire 52b224a8-3873-4eaf-9627-e6dc79685918 existe déjà
	at com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount(ProjectionBankAccountService.java:49)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.axonframework.messaging.annotation.AnnotatedMessageHandlingMember.handle(AnnotatedMessageHandlingMember.java:153)
	at org.axonframework.messaging.annotation.WrappedMessageHandlingMember.handle(WrappedMessageHandlingMember.java:64)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.lambda$handle$1(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.handle(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.messaging.annotation.AnnotatedHandlerInspector$NoMoreInterceptors.handle(AnnotatedHandlerInspector.java:386)
	at org.axonframework.eventhandling.AnnotationEventHandlerAdapter.handle(AnnotationEventHandlerAdapter.java:94)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.invokeHandlers(SimpleEventHandlerInvoker.java:128)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.handle(SimpleEventHandlerInvoker.java:114)
	at org.axonframework.eventhandling.MultiEventHandlerInvoker.handle(MultiEventHandlerInvoker.java:91)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$null$1(AbstractEventProcessor.java:173)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:57)
	at org.axonframework.messaging.interceptors.CorrelationDataInterceptor.handle(CorrelationDataInterceptor.java:67)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$3(TrackingEventProcessor.java:185)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$1(TrackingEventProcessor.java:179)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$processInUnitOfWork$2(AbstractEventProcessor.java:184)
	at org.axonframework.messaging.unitofwork.BatchingUnitOfWork.executeWithResult(BatchingUnitOfWork.java:92)
	at org.axonframework.eventhandling.AbstractEventProcessor.processInUnitOfWork(AbstractEventProcessor.java:166)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:490)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
14-02-2023 07:14:08.658 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Activation du compte en cours...
14-02-2023 07:14:34.217 [HikariPool-1 housekeeper] WARN  com.zaxxer.hikari.pool.HikariPool.run - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=55s403ms1µs600ns).
14-02-2023 07:14:44.325 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Le compte bancaire n° 52b224a8-3873-4eaf-9627-e6dc79685918 n'existe pas.
14-02-2023 07:14:44.327 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.axonframework.eventhandling.LoggingErrorHandler.onError - EventListener [ProjectionBankAccountService] failed to handle event [b1258899-e567-4761-9ce3-2ad9b25ca780] (com.example.eventsourcingcqrs.event.BankAccountActivatedEvent). Continuing processing with next listener
com.example.eventsourcingcqrs.exception.AccountNotFoundException: Le numéro de compte bancaire 52b224a8-3873-4eaf-9627-e6dc79685918 n'existe pas
	at com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount(ProjectionBankAccountService.java:67)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.axonframework.messaging.annotation.AnnotatedMessageHandlingMember.handle(AnnotatedMessageHandlingMember.java:153)
	at org.axonframework.messaging.annotation.WrappedMessageHandlingMember.handle(WrappedMessageHandlingMember.java:64)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.lambda$handle$1(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.handle(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.messaging.annotation.AnnotatedHandlerInspector$NoMoreInterceptors.handle(AnnotatedHandlerInspector.java:386)
	at org.axonframework.eventhandling.AnnotationEventHandlerAdapter.handle(AnnotationEventHandlerAdapter.java:94)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.invokeHandlers(SimpleEventHandlerInvoker.java:128)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.handle(SimpleEventHandlerInvoker.java:114)
	at org.axonframework.eventhandling.MultiEventHandlerInvoker.handle(MultiEventHandlerInvoker.java:91)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$null$1(AbstractEventProcessor.java:173)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:57)
	at org.axonframework.messaging.interceptors.CorrelationDataInterceptor.handle(CorrelationDataInterceptor.java:67)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$3(TrackingEventProcessor.java:185)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$1(TrackingEventProcessor.java:179)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$processInUnitOfWork$2(AbstractEventProcessor.java:184)
	at org.axonframework.messaging.unitofwork.BatchingUnitOfWork.executeWithResult(BatchingUnitOfWork.java:92)
	at org.axonframework.eventhandling.AbstractEventProcessor.processInUnitOfWork(AbstractEventProcessor.java:166)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:490)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
14-02-2023 07:14:44.346 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.service.projection'.
14-02-2023 07:14:44.346 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.service.projection' awaiting termination...
14-02-2023 07:14:45.336 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 07:14:45.336 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
14-02-2023 07:14:45.342 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Error occurred. Starting retry mode.
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:175)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:709)
	at org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStore.extendClaim(JpaTokenStore.java:232)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$processBatch$13(TrackingEventProcessor.java:462)
	at org.axonframework.common.transaction.TransactionManager.executeInTransaction(TransactionManager.java:47)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:461)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.lambda$executeUpdate$0(SimpleUpdateQueryPlan.java:99)
	at org.hibernate.sql.exec.internal.StandardJdbcMutationExecutor.execute(StandardJdbcMutationExecutor.java:63)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.executeUpdate(SimpleUpdateQueryPlan.java:93)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doExecuteUpdate(QuerySqmImpl.java:728)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:698)
	... 9 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTableOrView(Parser.java:8328)
	at org.h2.command.Parser.readSimpleTableFilter(Parser.java:1160)
	at org.h2.command.Parser.parseUpdate(Parser.java:1118)
	at org.h2.command.Parser.parsePrepared(Parser.java:858)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 15 common frames omitted
14-02-2023 07:14:45.342 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Releasing claim on token and preparing for retry in 1s
14-02-2023 07:14:45.342 [EmbeddedEventStore-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 07:14:45.342 [EmbeddedEventStore-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
14-02-2023 07:14:45.342 [EmbeddedEventStore-0] ERROR org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.fetchData - Failed to read events from the underlying event storage
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:374)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.list(QuerySqmImpl.java:1073)
	at org.hibernate.query.Query.getResultList(Query.java:94)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchEvents(JpaEventStorageEngine.java:181)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:194)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:70)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:194)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:148)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:289)
	at java.base/java.util.Spliterator.forEachRemaining(Spliterator.java:332)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:261)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:227)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2800(EmbeddedEventStore.java:204)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:148)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.lambda$list$0(JdbcSelectExecutorStandardImpl.java:100)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:171)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.getResultSet(DeferredResultSetAccess.java:146)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.advanceNext(JdbcValuesResultSetImpl.java:205)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.processNext(JdbcValuesResultSetImpl.java:85)
	at org.hibernate.sql.results.jdbc.internal.AbstractJdbcValues.next(AbstractJdbcValues.java:29)
	at org.hibernate.sql.results.internal.RowProcessingStateStandardImpl.next(RowProcessingStateStandardImpl.java:88)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:197)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:33)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:443)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:166)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.list(JdbcSelectExecutorStandardImpl.java:91)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:31)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.lambda$new$0(ConcreteSqmSelectQueryPlan.java:113)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.withCacheableSqmInterpretation(ConcreteSqmSelectQueryPlan.java:335)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.performList(ConcreteSqmSelectQueryPlan.java:276)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doList(QuerySqmImpl.java:571)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:363)
	... 20 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTablePrimary(Parser.java:1863)
	at org.h2.command.Parser.readTableReference(Parser.java:2334)
	at org.h2.command.Parser.parseSelectFromPart(Parser.java:2772)
	at org.h2.command.Parser.parseSelect(Parser.java:2878)
	at org.h2.command.Parser.parseQueryPrimary(Parser.java:2762)
	at org.h2.command.Parser.parseQueryTerm(Parser.java:2633)
	at org.h2.command.Parser.parseQueryExpressionBody(Parser.java:2612)
	at org.h2.command.Parser.parseQueryExpressionBodyAndEndOfQuery(Parser.java:2605)
	at org.h2.command.Parser.parseQueryExpression(Parser.java:2598)
	at org.h2.command.Parser.parseQuery(Parser.java:2567)
	at org.h2.command.Parser.parsePrepared(Parser.java:724)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 39 common frames omitted
14-02-2023 07:14:45.342 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 07:14:45.342 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 07:14:45.342 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 07:14:45.342 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 07:14:45.342 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 07:14:45.342 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 07:14:45.342 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Worker for segment Segment[0/0] stopped.
14-02-2023 07:14:45.368 [SpringApplicationShutdownHook] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.destroy - Closing JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 07:14:45.368 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown initiated...
14-02-2023 07:14:45.384 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown completed.
14-02-2023 07:14:49.247 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Starting EventSourcingCqrsApplication using Java 17.0.6 with PID 19480 (C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs\target\classes started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 07:14:49.250 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 07:14:49.250 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 07:14:49.335 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 07:14:49.335 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 07:14:49.335 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 07:14:49.335 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 07:14:49.351 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 07:14:49.841 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 07:14:49.904 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 59 ms. Found 1 JPA repository interfaces.
14-02-2023 07:14:50.176 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 07:14:50.348 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize - Tomcat initialized with port(s): 9090 (http)
14-02-2023 07:14:50.363 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Initializing ProtocolHandler ["http-nio-9090"]
14-02-2023 07:14:50.363 [main] INFO  org.apache.catalina.core.StandardService.log - Starting service [Tomcat]
14-02-2023 07:14:50.363 [main] INFO  org.apache.catalina.core.StandardEngine.log - Starting Servlet engine: [Apache Tomcat/10.1.5]
14-02-2023 07:14:50.426 [main] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring embedded WebApplicationContext
14-02-2023 07:14:50.426 [main] INFO  org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.prepareWebApplicationContext - Root WebApplicationContext: initialization completed in 1147 ms
14-02-2023 07:14:50.473 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 07:14:50.536 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 07:14:50.536 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 07:14:50.548 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 07:14:50.614 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 07:14:50.661 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 07:14:50.748 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 07:14:50.834 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 07:14:51.383 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 07:14:51.383 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 07:14:51.414 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 07:14:51.492 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 07:14:51.492 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 07:14:51.492 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 07:14:51.492 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 07:14:51.492 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 07:14:51.508 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 07:14:51.508 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 07:14:51.508 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 07:14:51.508 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 07:14:51.696 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 07:14:51.994 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 07:14:52.051 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Starting ProtocolHandler ["http-nio-9090"]
14-02-2023 07:14:52.057 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.start - Tomcat started on port(s): 9090 (http) with context path ''
14-02-2023 07:14:52.104 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarted - Started EventSourcingCqrsApplication in 3.275 seconds (process running for 3.855)
14-02-2023 07:14:52.342 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.lambda$run$3 - Worker assigned to segment Segment[0/0] for processing
14-02-2023 07:14:52.342 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Using current Thread for last segment worker: TrackingSegmentWorker{processor=com.example.eventsourcingcqrs.service.projection, segment=Segment[0/0]}
14-02-2023 07:14:52.342 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.ensureEventStreamOpened - Fetched token: null for segment: Segment[0/0]
14-02-2023 07:15:08.789 [http-nio-9090-exec-1] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring DispatcherServlet 'dispatcherServlet'
14-02-2023 07:15:08.789 [http-nio-9090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Initializing Servlet 'dispatcherServlet'
14-02-2023 07:15:08.790 [http-nio-9090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Completed initialization in 1 ms
14-02-2023 07:15:08.843 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.<init> - Une commande pour la création d'un nouveau compte bancaire [b580a06d-6ec9-4b38-9172-55b7a46bc821] a été effectué.
14-02-2023 07:15:08.846 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°b580a06d-6ec9-4b38-9172-55b7a46bc821 est en cours...
14-02-2023 07:15:08.848 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°b580a06d-6ec9-4b38-9172-55b7a46bc821 est en cours...
14-02-2023 07:15:08.910 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Création en base du compte n°b580a06d-6ec9-4b38-9172-55b7a46bc821.
14-02-2023 07:15:11.672 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Sauvegarde en base du compte n°b580a06d-6ec9-4b38-9172-55b7a46bc821.
14-02-2023 07:15:11.672 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Activation du compte en cours...
14-02-2023 07:15:11.672 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Compte n°b580a06d-6ec9-4b38-9172-55b7a46bc821 activé, sauvegarde en base du nouveau statut.
14-02-2023 07:15:19.480 [http-nio-9090-exec-2] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.<init> - Une commande pour la création d'un nouveau compte bancaire [1dd44676-db58-443a-abe8-e985c7791d68] a été effectué.
14-02-2023 07:15:19.480 [http-nio-9090-exec-2] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°1dd44676-db58-443a-abe8-e985c7791d68 est en cours...
14-02-2023 07:15:19.480 [http-nio-9090-exec-2] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°1dd44676-db58-443a-abe8-e985c7791d68 est en cours...
14-02-2023 07:15:19.486 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Création en base du compte n°1dd44676-db58-443a-abe8-e985c7791d68.
14-02-2023 07:15:26.334 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Le compte bancaire n° 1dd44676-db58-443a-abe8-e985c7791d68 existe déjà.
14-02-2023 07:15:26.334 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.axonframework.eventhandling.LoggingErrorHandler.onError - EventListener [ProjectionBankAccountService] failed to handle event [c4c9fc20-ab06-4a1b-907d-8a04f986c271] (com.example.eventsourcingcqrs.event.BankAccountCreatedEvent). Continuing processing with next listener
com.example.eventsourcingcqrs.exception.AccountFoundException: Le numéro de compte bancaire 1dd44676-db58-443a-abe8-e985c7791d68 existe déjà
	at com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount(ProjectionBankAccountService.java:49)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.axonframework.messaging.annotation.AnnotatedMessageHandlingMember.handle(AnnotatedMessageHandlingMember.java:153)
	at org.axonframework.messaging.annotation.WrappedMessageHandlingMember.handle(WrappedMessageHandlingMember.java:64)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.lambda$handle$1(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.handle(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.messaging.annotation.AnnotatedHandlerInspector$NoMoreInterceptors.handle(AnnotatedHandlerInspector.java:386)
	at org.axonframework.eventhandling.AnnotationEventHandlerAdapter.handle(AnnotationEventHandlerAdapter.java:94)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.invokeHandlers(SimpleEventHandlerInvoker.java:128)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.handle(SimpleEventHandlerInvoker.java:114)
	at org.axonframework.eventhandling.MultiEventHandlerInvoker.handle(MultiEventHandlerInvoker.java:91)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$null$1(AbstractEventProcessor.java:173)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:57)
	at org.axonframework.messaging.interceptors.CorrelationDataInterceptor.handle(CorrelationDataInterceptor.java:67)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$3(TrackingEventProcessor.java:185)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$1(TrackingEventProcessor.java:179)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$processInUnitOfWork$2(AbstractEventProcessor.java:184)
	at org.axonframework.messaging.unitofwork.BatchingUnitOfWork.executeWithResult(BatchingUnitOfWork.java:92)
	at org.axonframework.eventhandling.AbstractEventProcessor.processInUnitOfWork(AbstractEventProcessor.java:166)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:490)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
14-02-2023 07:15:26.337 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Activation du compte en cours...
14-02-2023 07:15:57.696 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Le compte bancaire n° 1dd44676-db58-443a-abe8-e985c7791d68 n'existe pas.
14-02-2023 07:15:57.696 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.axonframework.eventhandling.LoggingErrorHandler.onError - EventListener [ProjectionBankAccountService] failed to handle event [1fc64214-1793-47d7-9448-d6ba1c072380] (com.example.eventsourcingcqrs.event.BankAccountActivatedEvent). Continuing processing with next listener
com.example.eventsourcingcqrs.exception.AccountNotFoundException: Le numéro de compte bancaire 1dd44676-db58-443a-abe8-e985c7791d68 n'existe pas
	at com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount(ProjectionBankAccountService.java:67)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.axonframework.messaging.annotation.AnnotatedMessageHandlingMember.handle(AnnotatedMessageHandlingMember.java:153)
	at org.axonframework.messaging.annotation.WrappedMessageHandlingMember.handle(WrappedMessageHandlingMember.java:64)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.lambda$handle$1(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.handle(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.messaging.annotation.AnnotatedHandlerInspector$NoMoreInterceptors.handle(AnnotatedHandlerInspector.java:386)
	at org.axonframework.eventhandling.AnnotationEventHandlerAdapter.handle(AnnotationEventHandlerAdapter.java:94)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.invokeHandlers(SimpleEventHandlerInvoker.java:128)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.handle(SimpleEventHandlerInvoker.java:114)
	at org.axonframework.eventhandling.MultiEventHandlerInvoker.handle(MultiEventHandlerInvoker.java:91)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$null$1(AbstractEventProcessor.java:173)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:57)
	at org.axonframework.messaging.interceptors.CorrelationDataInterceptor.handle(CorrelationDataInterceptor.java:67)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$3(TrackingEventProcessor.java:185)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$1(TrackingEventProcessor.java:179)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$processInUnitOfWork$2(AbstractEventProcessor.java:184)
	at org.axonframework.messaging.unitofwork.BatchingUnitOfWork.executeWithResult(BatchingUnitOfWork.java:92)
	at org.axonframework.eventhandling.AbstractEventProcessor.processInUnitOfWork(AbstractEventProcessor.java:166)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:490)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
14-02-2023 07:16:06.046 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.service.projection'.
14-02-2023 07:16:06.047 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.service.projection' awaiting termination...
14-02-2023 07:18:07.413 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Starting EventSourcingCqrsApplication using Java 17.0.6 with PID 24024 (C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs\target\classes started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 07:18:07.413 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 07:18:07.413 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 07:18:07.482 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 07:18:07.482 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 07:18:07.482 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 07:18:07.482 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 07:18:07.502 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 07:18:07.994 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 07:18:08.057 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 59 ms. Found 1 JPA repository interfaces.
14-02-2023 07:18:08.344 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 07:18:08.517 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize - Tomcat initialized with port(s): 9090 (http)
14-02-2023 07:18:08.517 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Initializing ProtocolHandler ["http-nio-9090"]
14-02-2023 07:18:08.533 [main] INFO  org.apache.catalina.core.StandardService.log - Starting service [Tomcat]
14-02-2023 07:18:08.533 [main] INFO  org.apache.catalina.core.StandardEngine.log - Starting Servlet engine: [Apache Tomcat/10.1.5]
14-02-2023 07:18:08.596 [main] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring embedded WebApplicationContext
14-02-2023 07:18:08.596 [main] INFO  org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.prepareWebApplicationContext - Root WebApplicationContext: initialization completed in 1156 ms
14-02-2023 07:18:08.643 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 07:18:08.705 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 07:18:08.705 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 07:18:08.721 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 07:18:08.799 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 07:18:08.846 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 07:18:08.941 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 07:18:09.019 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 07:18:09.615 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 07:18:09.615 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 07:18:09.646 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 07:18:09.740 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 07:18:09.740 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 07:18:09.740 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 07:18:09.740 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 07:18:09.740 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 07:18:09.740 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 07:18:09.740 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 07:18:09.740 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 07:18:09.740 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 07:18:09.944 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 07:18:10.247 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 07:18:10.294 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Starting ProtocolHandler ["http-nio-9090"]
14-02-2023 07:18:10.310 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.start - Tomcat started on port(s): 9090 (http) with context path ''
14-02-2023 07:18:10.357 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarted - Started EventSourcingCqrsApplication in 3.291 seconds (process running for 3.929)
14-02-2023 07:18:10.592 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.lambda$run$3 - Worker assigned to segment Segment[0/0] for processing
14-02-2023 07:18:10.608 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Using current Thread for last segment worker: TrackingSegmentWorker{processor=com.example.eventsourcingcqrs.service.projection, segment=Segment[0/0]}
14-02-2023 07:18:10.608 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.ensureEventStreamOpened - Fetched token: null for segment: Segment[0/0]
14-02-2023 07:18:15.239 [http-nio-9090-exec-1] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring DispatcherServlet 'dispatcherServlet'
14-02-2023 07:18:15.239 [http-nio-9090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Initializing Servlet 'dispatcherServlet'
14-02-2023 07:18:15.240 [http-nio-9090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Completed initialization in 1 ms
14-02-2023 07:18:15.295 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.<init> - Une commande pour la création d'un nouveau compte bancaire [ff236af3-1624-40ce-b881-871bf6b5bfe4] a été effectué.
14-02-2023 07:18:15.298 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°ff236af3-1624-40ce-b881-871bf6b5bfe4 est en cours...
14-02-2023 07:18:15.301 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°ff236af3-1624-40ce-b881-871bf6b5bfe4 est en cours...
14-02-2023 07:18:15.384 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Création en base du compte n°ff236af3-1624-40ce-b881-871bf6b5bfe4.
14-02-2023 07:18:15.411 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Sauvegarde en base du compte n°ff236af3-1624-40ce-b881-871bf6b5bfe4.
14-02-2023 07:18:15.423 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Activation du compte en cours...
14-02-2023 07:18:15.424 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Compte n°ff236af3-1624-40ce-b881-871bf6b5bfe4 activé, sauvegarde en base du nouveau statut.
14-02-2023 07:18:24.806 [http-nio-9090-exec-2] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.<init> - Une commande pour la création d'un nouveau compte bancaire [e0ca9150-a589-468b-bddf-018354dd4860] a été effectué.
14-02-2023 07:18:24.807 [http-nio-9090-exec-2] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°e0ca9150-a589-468b-bddf-018354dd4860 est en cours...
14-02-2023 07:18:24.807 [http-nio-9090-exec-2] DEBUG com.example.eventsourcingcqrs.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°e0ca9150-a589-468b-bddf-018354dd4860 est en cours...
14-02-2023 07:18:24.812 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Création en base du compte n°e0ca9150-a589-468b-bddf-018354dd4860.
14-02-2023 07:18:33.203 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount - Le compte bancaire n° e0ca9150-a589-468b-bddf-018354dd4860 existe déjà.
14-02-2023 07:18:33.204 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.axonframework.eventhandling.LoggingErrorHandler.onError - EventListener [ProjectionBankAccountService] failed to handle event [235df6bb-a24c-4fcd-b2dc-c083f39d3bb9] (com.example.eventsourcingcqrs.event.BankAccountCreatedEvent). Continuing processing with next listener
com.example.eventsourcingcqrs.exception.AccountFoundException: Le numéro de compte bancaire e0ca9150-a589-468b-bddf-018354dd4860 existe déjà
	at com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.createBankAccount(ProjectionBankAccountService.java:50)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.axonframework.messaging.annotation.AnnotatedMessageHandlingMember.handle(AnnotatedMessageHandlingMember.java:153)
	at org.axonframework.messaging.annotation.WrappedMessageHandlingMember.handle(WrappedMessageHandlingMember.java:64)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.lambda$handle$1(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.handle(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.messaging.annotation.AnnotatedHandlerInspector$NoMoreInterceptors.handle(AnnotatedHandlerInspector.java:386)
	at org.axonframework.eventhandling.AnnotationEventHandlerAdapter.handle(AnnotationEventHandlerAdapter.java:94)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.invokeHandlers(SimpleEventHandlerInvoker.java:128)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.handle(SimpleEventHandlerInvoker.java:114)
	at org.axonframework.eventhandling.MultiEventHandlerInvoker.handle(MultiEventHandlerInvoker.java:91)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$null$1(AbstractEventProcessor.java:173)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:57)
	at org.axonframework.messaging.interceptors.CorrelationDataInterceptor.handle(CorrelationDataInterceptor.java:67)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$3(TrackingEventProcessor.java:185)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$1(TrackingEventProcessor.java:179)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$processInUnitOfWork$2(AbstractEventProcessor.java:184)
	at org.axonframework.messaging.unitofwork.BatchingUnitOfWork.executeWithResult(BatchingUnitOfWork.java:92)
	at org.axonframework.eventhandling.AbstractEventProcessor.processInUnitOfWork(AbstractEventProcessor.java:166)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:490)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
14-02-2023 07:18:33.209 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] DEBUG com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Activation du compte en cours...
14-02-2023 07:18:43.964 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount - Le compte bancaire n° e0ca9150-a589-468b-bddf-018354dd4860 est déjà activé.
14-02-2023 07:18:46.164 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.axonframework.eventhandling.LoggingErrorHandler.onError - EventListener [ProjectionBankAccountService] failed to handle event [4ccf0b8f-0c38-4e26-9931-880797a491d5] (com.example.eventsourcingcqrs.event.BankAccountActivatedEvent). Continuing processing with next listener
com.example.eventsourcingcqrs.exception.AccountAlreadyActivatedException: Le compte bancaire n° e0ca9150-a589-468b-bddf-018354dd4860 est déjà activé.
	at com.example.eventsourcingcqrs.service.projection.ProjectionBankAccountService.activateBankAccount(ProjectionBankAccountService.java:69)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.axonframework.messaging.annotation.AnnotatedMessageHandlingMember.handle(AnnotatedMessageHandlingMember.java:153)
	at org.axonframework.messaging.annotation.WrappedMessageHandlingMember.handle(WrappedMessageHandlingMember.java:64)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.lambda$handle$1(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.handle(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.messaging.annotation.AnnotatedHandlerInspector$NoMoreInterceptors.handle(AnnotatedHandlerInspector.java:386)
	at org.axonframework.eventhandling.AnnotationEventHandlerAdapter.handle(AnnotationEventHandlerAdapter.java:94)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.invokeHandlers(SimpleEventHandlerInvoker.java:128)
	at org.axonframework.eventhandling.SimpleEventHandlerInvoker.handle(SimpleEventHandlerInvoker.java:114)
	at org.axonframework.eventhandling.MultiEventHandlerInvoker.handle(MultiEventHandlerInvoker.java:91)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$null$1(AbstractEventProcessor.java:173)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:57)
	at org.axonframework.messaging.interceptors.CorrelationDataInterceptor.handle(CorrelationDataInterceptor.java:67)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$3(TrackingEventProcessor.java:185)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$new$1(TrackingEventProcessor.java:179)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.eventhandling.AbstractEventProcessor.lambda$processInUnitOfWork$2(AbstractEventProcessor.java:184)
	at org.axonframework.messaging.unitofwork.BatchingUnitOfWork.executeWithResult(BatchingUnitOfWork.java:92)
	at org.axonframework.eventhandling.AbstractEventProcessor.processInUnitOfWork(AbstractEventProcessor.java:166)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:490)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
14-02-2023 07:19:09.858 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.service.projection'.
14-02-2023 07:19:09.858 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.service.projection' awaiting termination...
14-02-2023 09:51:27.115 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStarting - Starting EventSourcingCqrsApplicationTests using Java 17.0.6 with PID 22916 (started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 09:51:27.116 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 09:51:27.117 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 09:51:27.207 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 09:51:27.211 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 09:51:27.213 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 09:51:27.214 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 09:51:27.299 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 09:51:27.936 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 09:51:28.013 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 68 ms. Found 1 JPA repository interfaces.
14-02-2023 09:51:28.377 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 09:51:28.398 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.modelling.command.AggregateIdentifier with appropriate @AliasFor declarations: [routingKey]
14-02-2023 09:51:28.613 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 09:51:28.661 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 09:51:28.821 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 09:51:28.979 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 09:51:29.132 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 09:51:29.134 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 09:51:29.150 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 09:51:29.896 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 09:51:29.904 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 09:51:29.962 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 09:51:30.081 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 09:51:30.082 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 09:51:30.082 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 09:51:30.083 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 09:51:30.083 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 09:51:30.091 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 09:51:30.092 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 09:51:30.093 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 09:51:30.093 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/ParsingException
14-02-2023 09:51:30.466 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 09:51:30.934 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 09:51:30.949 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 09:51:31.088 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStarted - Started EventSourcingCqrsApplicationTests in 4.303 seconds (process running for 5.295)
14-02-2023 09:51:31.315 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.service.projection'.
14-02-2023 09:51:31.315 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.service.projection' awaiting termination...
14-02-2023 09:51:31.342 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 90121, SQLState: 90121
14-02-2023 09:51:31.343 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - La base de donn�es est d�j� ferm�e (pour d�sactiver la fermeture automatique � l'arr�t de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE" � l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
14-02-2023 09:51:31.348 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 90121, SQLState: 90121
14-02-2023 09:51:31.348 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - La base de donn�es est d�j� ferm�e (pour d�sactiver la fermeture automatique � l'arr�t de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE" � l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
14-02-2023 09:51:31.348 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] ERROR org.springframework.orm.jpa.EntityManagerFactoryUtils.closeEntityManager - Failed to release JPA EntityManager
org.hibernate.exception.JDBCConnectionException: Unable to release JDBC Connection
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:49)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:95)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.releaseConnection(LogicalConnectionManagedImpl.java:222)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.close(LogicalConnectionManagedImpl.java:252)
	at org.hibernate.engine.jdbc.internal.JdbcCoordinatorImpl.close(JdbcCoordinatorImpl.java:170)
	at org.hibernate.internal.AbstractSharedSessionContract.close(AbstractSharedSessionContract.java:376)
	at org.hibernate.internal.SessionImpl.closeWithoutOpenChecks(SessionImpl.java:404)
	at org.hibernate.internal.SessionImpl.close(SessionImpl.java:389)
	at org.springframework.orm.jpa.EntityManagerFactoryUtils.closeEntityManager(EntityManagerFactoryUtils.java:424)
	at org.springframework.orm.jpa.JpaTransactionManager.doCleanupAfterCompletion(JpaTransactionManager.java:650)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.cleanupAfterCompletion(AbstractPlatformTransactionManager.java:992)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processRollback(AbstractPlatformTransactionManager.java:875)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.rollback(AbstractPlatformTransactionManager.java:809)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager.rollbackTransaction(SpringTransactionManager.java:97)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager$1.rollback(SpringTransactionManager.java:74)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:74)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1210)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.h2.jdbc.JdbcSQLNonTransientConnectionException: La base de donn�es est d�j� ferm�e (pour d�sactiver la fermeture automatique � l'arr�t de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE" � l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:678)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.get(DbException.java:188)
	at org.h2.jdbc.JdbcConnection.checkClosed(JdbcConnection.java:1375)
	at org.h2.jdbc.JdbcConnection.setAutoCommit(JdbcConnection.java:402)
	at com.zaxxer.hikari.pool.PoolBase.resetConnectionState(PoolBase.java:214)
	at com.zaxxer.hikari.pool.PoolEntry.resetConnectionState(PoolEntry.java:106)
	at com.zaxxer.hikari.pool.ProxyConnection.close(ProxyConnection.java:254)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.closeConnection(DatasourceConnectionProviderImpl.java:127)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.releaseConnection(NonContextualJdbcConnectionAccess.java:49)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.releaseConnection(LogicalConnectionManagedImpl.java:218)
	... 15 common frames omitted
14-02-2023 09:51:31.351 [EventProcessor[com.example.eventsourcingcqrs.service.projection]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.run - Fetch Segments for Processor 'com.example.eventsourcingcqrs.service.projection' failed: Could not roll back JPA transaction. Preparing for retry in 1s
org.springframework.transaction.TransactionSystemException: Could not roll back JPA transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doRollback(JpaTransactionManager.java:593)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processRollback(AbstractPlatformTransactionManager.java:835)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.rollback(AbstractPlatformTransactionManager.java:809)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager.rollbackTransaction(SpringTransactionManager.java:97)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager$1.rollback(SpringTransactionManager.java:74)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:74)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1210)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.TransactionException: Unable to rollback against JDBC Connection
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.rollback(AbstractLogicalConnectionImplementor.java:127)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.rollback(JdbcResourceLocalTransactionCoordinatorImpl.java:304)
	at org.hibernate.engine.transaction.internal.TransactionImpl.rollback(TransactionImpl.java:142)
	at org.springframework.orm.jpa.JpaTransactionManager.doRollback(JpaTransactionManager.java:589)
	... 7 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLNonTransientConnectionException: La base de donn�es est d�j� ferm�e (pour d�sactiver la fermeture automatique � l'arr�t de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE" � l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:678)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.get(DbException.java:188)
	at org.h2.jdbc.JdbcConnection.checkClosed(JdbcConnection.java:1375)
	at org.h2.jdbc.JdbcConnection.rollback(JdbcConnection.java:463)
	at com.zaxxer.hikari.pool.ProxyConnection.rollback(ProxyConnection.java:385)
	at com.zaxxer.hikari.pool.HikariProxyConnection.rollback(HikariProxyConnection.java)
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.rollback(AbstractLogicalConnectionImplementor.java:121)
	... 10 common frames omitted
14-02-2023 09:51:31.373 [SpringApplicationShutdownHook] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.destroy - Closing JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 09:51:31.375 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown initiated...
14-02-2023 09:51:31.377 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown completed.
14-02-2023 10:06:01.175 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Starting EventSourcingCqrsApplication using Java 17.0.6 with PID 18832 (C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs\target\classes started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 10:06:01.179 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 10:06:01.179 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 10:06:01.243 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 10:06:01.259 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:06:01.259 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:06:01.259 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:06:01.306 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:06:01.804 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 10:06:13.722 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStarting - Starting EventSourcingCqrsApplicationTests using Java 17.0.6 with PID 21932 (started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 10:06:13.722 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 10:06:13.722 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 10:06:13.808 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 10:06:13.815 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:06:13.815 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:06:13.815 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:06:13.878 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:06:14.512 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 10:06:14.590 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 66 ms. Found 1 JPA repository interfaces.
14-02-2023 10:06:14.935 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 10:06:14.950 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.modelling.command.AggregateIdentifier with appropriate @AliasFor declarations: [routingKey]
14-02-2023 10:06:15.139 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 10:06:15.185 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 10:06:15.358 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 10:06:15.515 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 10:06:15.656 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 10:06:15.656 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 10:06:15.687 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 10:06:16.414 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 10:06:16.414 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 10:06:16.476 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 10:06:16.586 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 10:06:16.586 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 10:06:16.586 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 10:06:16.586 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 10:06:16.586 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 10:06:16.602 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 10:06:16.602 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 10:06:16.613 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 10:06:16.613 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/ParsingException
14-02-2023 10:06:16.947 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 10:06:17.386 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 10:06:17.414 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 10:06:17.527 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStarted - Started EventSourcingCqrsApplicationTests in 4.12 seconds (process running for 4.842)
14-02-2023 10:06:17.792 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.query.api.service'.
14-02-2023 10:06:17.792 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.query.api.service' awaiting termination...
14-02-2023 10:06:17.815 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 90121, SQLState: 90121
14-02-2023 10:06:17.815 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - La base de donn�es est d�j� ferm�e (pour d�sactiver la fermeture automatique � l'arr�t de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE" � l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
14-02-2023 10:06:17.815 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 90121, SQLState: 90121
14-02-2023 10:06:17.824 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - La base de donn�es est d�j� ferm�e (pour d�sactiver la fermeture automatique � l'arr�t de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE" � l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
14-02-2023 10:06:17.824 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.springframework.orm.jpa.EntityManagerFactoryUtils.closeEntityManager - Failed to release JPA EntityManager
org.hibernate.exception.JDBCConnectionException: Unable to release JDBC Connection
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:49)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:95)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.releaseConnection(LogicalConnectionManagedImpl.java:222)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.close(LogicalConnectionManagedImpl.java:252)
	at org.hibernate.engine.jdbc.internal.JdbcCoordinatorImpl.close(JdbcCoordinatorImpl.java:170)
	at org.hibernate.internal.AbstractSharedSessionContract.close(AbstractSharedSessionContract.java:376)
	at org.hibernate.internal.SessionImpl.closeWithoutOpenChecks(SessionImpl.java:404)
	at org.hibernate.internal.SessionImpl.close(SessionImpl.java:389)
	at org.springframework.orm.jpa.EntityManagerFactoryUtils.closeEntityManager(EntityManagerFactoryUtils.java:424)
	at org.springframework.orm.jpa.JpaTransactionManager.doCleanupAfterCompletion(JpaTransactionManager.java:650)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.cleanupAfterCompletion(AbstractPlatformTransactionManager.java:992)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processRollback(AbstractPlatformTransactionManager.java:875)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.rollback(AbstractPlatformTransactionManager.java:809)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager.rollbackTransaction(SpringTransactionManager.java:97)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager$1.rollback(SpringTransactionManager.java:74)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:74)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1210)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.h2.jdbc.JdbcSQLNonTransientConnectionException: La base de donn�es est d�j� ferm�e (pour d�sactiver la fermeture automatique � l'arr�t de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE" � l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:678)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.get(DbException.java:188)
	at org.h2.jdbc.JdbcConnection.checkClosed(JdbcConnection.java:1375)
	at org.h2.jdbc.JdbcConnection.setAutoCommit(JdbcConnection.java:402)
	at com.zaxxer.hikari.pool.PoolBase.resetConnectionState(PoolBase.java:214)
	at com.zaxxer.hikari.pool.PoolEntry.resetConnectionState(PoolEntry.java:106)
	at com.zaxxer.hikari.pool.ProxyConnection.close(ProxyConnection.java:254)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.closeConnection(DatasourceConnectionProviderImpl.java:127)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.releaseConnection(NonContextualJdbcConnectionAccess.java:49)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.releaseConnection(LogicalConnectionManagedImpl.java:218)
	... 15 common frames omitted
14-02-2023 10:06:17.824 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.run - Fetch Segments for Processor 'com.example.eventsourcingcqrs.query.api.service' failed: Could not roll back JPA transaction. Preparing for retry in 1s
org.springframework.transaction.TransactionSystemException: Could not roll back JPA transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doRollback(JpaTransactionManager.java:593)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processRollback(AbstractPlatformTransactionManager.java:835)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.rollback(AbstractPlatformTransactionManager.java:809)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager.rollbackTransaction(SpringTransactionManager.java:97)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager$1.rollback(SpringTransactionManager.java:74)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:74)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1210)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.TransactionException: Unable to rollback against JDBC Connection
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.rollback(AbstractLogicalConnectionImplementor.java:127)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.rollback(JdbcResourceLocalTransactionCoordinatorImpl.java:304)
	at org.hibernate.engine.transaction.internal.TransactionImpl.rollback(TransactionImpl.java:142)
	at org.springframework.orm.jpa.JpaTransactionManager.doRollback(JpaTransactionManager.java:589)
	... 7 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLNonTransientConnectionException: La base de donn�es est d�j� ferm�e (pour d�sactiver la fermeture automatique � l'arr�t de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE" � l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:678)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.get(DbException.java:188)
	at org.h2.jdbc.JdbcConnection.checkClosed(JdbcConnection.java:1375)
	at org.h2.jdbc.JdbcConnection.rollback(JdbcConnection.java:463)
	at com.zaxxer.hikari.pool.ProxyConnection.rollback(ProxyConnection.java:385)
	at com.zaxxer.hikari.pool.HikariProxyConnection.rollback(HikariProxyConnection.java)
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.rollback(AbstractLogicalConnectionImplementor.java:121)
	... 10 common frames omitted
14-02-2023 10:06:17.840 [SpringApplicationShutdownHook] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.destroy - Closing JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 10:06:17.840 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown initiated...
14-02-2023 10:06:17.840 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown completed.
14-02-2023 10:06:27.032 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Starting EventSourcingCqrsApplication using Java 17.0.6 with PID 19636 (C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs\target\classes started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 10:06:27.032 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 10:06:27.032 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 10:06:27.095 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 10:06:27.111 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:06:27.111 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:06:27.111 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:06:27.127 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:06:27.618 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 10:06:27.681 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 59 ms. Found 1 JPA repository interfaces.
14-02-2023 10:06:27.964 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 10:06:28.136 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize - Tomcat initialized with port(s): 9090 (http)
14-02-2023 10:06:28.153 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Initializing ProtocolHandler ["http-nio-9090"]
14-02-2023 10:06:28.154 [main] INFO  org.apache.catalina.core.StandardService.log - Starting service [Tomcat]
14-02-2023 10:06:28.154 [main] INFO  org.apache.catalina.core.StandardEngine.log - Starting Servlet engine: [Apache Tomcat/10.1.5]
14-02-2023 10:06:28.204 [main] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring embedded WebApplicationContext
14-02-2023 10:06:28.204 [main] INFO  org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.prepareWebApplicationContext - Root WebApplicationContext: initialization completed in 1149 ms
14-02-2023 10:06:28.267 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 10:06:28.334 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 10:06:28.345 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 10:06:28.345 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 10:06:28.434 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 10:06:28.455 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 10:06:28.565 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 10:06:28.643 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 10:06:29.193 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 10:06:29.193 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 10:06:29.235 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 10:06:29.302 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 10:06:29.302 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 10:06:29.302 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 10:06:29.302 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 10:06:29.302 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 10:06:29.318 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 10:06:29.318 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 10:06:29.318 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 10:06:29.318 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 10:06:29.506 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 10:06:29.789 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 10:06:29.852 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Starting ProtocolHandler ["http-nio-9090"]
14-02-2023 10:06:29.867 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.start - Tomcat started on port(s): 9090 (http) with context path ''
14-02-2023 10:06:29.898 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarted - Started EventSourcingCqrsApplication in 3.25 seconds (process running for 3.707)
14-02-2023 10:06:30.155 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.lambda$run$3 - Worker assigned to segment Segment[0/0] for processing
14-02-2023 10:06:30.155 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Using current Thread for last segment worker: TrackingSegmentWorker{processor=com.example.eventsourcingcqrs.query.api.service, segment=Segment[0/0]}
14-02-2023 10:06:30.155 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.ensureEventStreamOpened - Fetched token: null for segment: Segment[0/0]
14-02-2023 10:08:41.605 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.query.api.service'.
14-02-2023 10:08:41.605 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.query.api.service' awaiting termination...
14-02-2023 10:08:41.813 [EmbeddedEventStore-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 10:08:41.813 [EmbeddedEventStore-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
14-02-2023 10:08:41.819 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 10:08:41.819 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
14-02-2023 10:08:41.820 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Error occurred. Starting retry mode.
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:175)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:709)
	at org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStore.extendClaim(JpaTokenStore.java:232)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$processBatch$13(TrackingEventProcessor.java:462)
	at org.axonframework.common.transaction.TransactionManager.executeInTransaction(TransactionManager.java:47)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:461)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.lambda$executeUpdate$0(SimpleUpdateQueryPlan.java:99)
	at org.hibernate.sql.exec.internal.StandardJdbcMutationExecutor.execute(StandardJdbcMutationExecutor.java:63)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.executeUpdate(SimpleUpdateQueryPlan.java:93)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doExecuteUpdate(QuerySqmImpl.java:728)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:698)
	... 9 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTableOrView(Parser.java:8328)
	at org.h2.command.Parser.readSimpleTableFilter(Parser.java:1160)
	at org.h2.command.Parser.parseUpdate(Parser.java:1118)
	at org.h2.command.Parser.parsePrepared(Parser.java:858)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 15 common frames omitted
14-02-2023 10:08:41.818 [EmbeddedEventStore-0] ERROR org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.fetchData - Failed to read events from the underlying event storage
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:374)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.list(QuerySqmImpl.java:1073)
	at org.hibernate.query.Query.getResultList(Query.java:94)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchEvents(JpaEventStorageEngine.java:181)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:194)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:70)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:194)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:148)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:289)
	at java.base/java.util.Spliterator.forEachRemaining(Spliterator.java:332)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:261)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:227)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2800(EmbeddedEventStore.java:204)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:148)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.lambda$list$0(JdbcSelectExecutorStandardImpl.java:100)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:171)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.getResultSet(DeferredResultSetAccess.java:146)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.advanceNext(JdbcValuesResultSetImpl.java:205)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.processNext(JdbcValuesResultSetImpl.java:85)
	at org.hibernate.sql.results.jdbc.internal.AbstractJdbcValues.next(AbstractJdbcValues.java:29)
	at org.hibernate.sql.results.internal.RowProcessingStateStandardImpl.next(RowProcessingStateStandardImpl.java:88)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:197)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:33)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:443)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:166)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.list(JdbcSelectExecutorStandardImpl.java:91)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:31)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.lambda$new$0(ConcreteSqmSelectQueryPlan.java:113)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.withCacheableSqmInterpretation(ConcreteSqmSelectQueryPlan.java:335)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.performList(ConcreteSqmSelectQueryPlan.java:276)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doList(QuerySqmImpl.java:571)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:363)
	... 20 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTablePrimary(Parser.java:1863)
	at org.h2.command.Parser.readTableReference(Parser.java:2334)
	at org.h2.command.Parser.parseSelectFromPart(Parser.java:2772)
	at org.h2.command.Parser.parseSelect(Parser.java:2878)
	at org.h2.command.Parser.parseQueryPrimary(Parser.java:2762)
	at org.h2.command.Parser.parseQueryTerm(Parser.java:2633)
	at org.h2.command.Parser.parseQueryExpressionBody(Parser.java:2612)
	at org.h2.command.Parser.parseQueryExpressionBodyAndEndOfQuery(Parser.java:2605)
	at org.h2.command.Parser.parseQueryExpression(Parser.java:2598)
	at org.h2.command.Parser.parseQuery(Parser.java:2567)
	at org.h2.command.Parser.parsePrepared(Parser.java:724)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 39 common frames omitted
14-02-2023 10:08:41.821 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Releasing claim on token and preparing for retry in 1s
14-02-2023 10:08:41.824 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 10:08:41.824 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 10:08:41.824 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 10:08:41.825 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 10:08:41.825 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 10:08:41.825 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 10:08:41.826 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Worker for segment Segment[0/0] stopped.
14-02-2023 10:08:41.850 [SpringApplicationShutdownHook] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.destroy - Closing JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 10:08:41.852 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown initiated...
14-02-2023 10:08:41.853 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown completed.
14-02-2023 10:08:44.504 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Starting EventSourcingCqrsApplication using Java 17.0.6 with PID 21208 (C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs\target\classes started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 10:08:44.506 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 10:08:44.507 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 10:08:44.630 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 10:08:44.635 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:08:44.636 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:08:44.638 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:08:44.654 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:08:45.195 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 10:08:45.295 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 93 ms. Found 1 JPA repository interfaces.
14-02-2023 10:08:45.606 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 10:08:45.777 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize - Tomcat initialized with port(s): 9090 (http)
14-02-2023 10:08:45.783 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Initializing ProtocolHandler ["http-nio-9090"]
14-02-2023 10:08:45.784 [main] INFO  org.apache.catalina.core.StandardService.log - Starting service [Tomcat]
14-02-2023 10:08:45.784 [main] INFO  org.apache.catalina.core.StandardEngine.log - Starting Servlet engine: [Apache Tomcat/10.1.5]
14-02-2023 10:08:45.851 [main] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring embedded WebApplicationContext
14-02-2023 10:08:45.852 [main] INFO  org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.prepareWebApplicationContext - Root WebApplicationContext: initialization completed in 1292 ms
14-02-2023 10:08:45.906 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 10:08:45.975 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 10:08:45.977 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 10:08:45.985 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 10:08:46.107 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 10:08:46.151 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 10:08:46.254 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 10:08:46.349 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 10:08:46.919 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 10:08:46.926 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 10:08:46.958 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 10:08:47.036 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 10:08:47.037 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 10:08:47.037 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 10:08:47.037 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 10:08:47.037 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 10:08:47.043 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 10:08:47.044 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 10:08:47.044 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 10:08:47.045 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 10:08:47.234 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 10:08:47.519 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 10:08:47.576 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Starting ProtocolHandler ["http-nio-9090"]
14-02-2023 10:08:47.590 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.start - Tomcat started on port(s): 9090 (http) with context path ''
14-02-2023 10:08:47.631 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarted - Started EventSourcingCqrsApplication in 3.558 seconds (process running for 4.087)
14-02-2023 10:08:47.877 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.lambda$run$3 - Worker assigned to segment Segment[0/0] for processing
14-02-2023 10:08:47.882 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Using current Thread for last segment worker: TrackingSegmentWorker{processor=com.example.eventsourcingcqrs.query.api.service, segment=Segment[0/0]}
14-02-2023 10:08:47.884 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.ensureEventStreamOpened - Fetched token: null for segment: Segment[0/0]
14-02-2023 10:09:07.007 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.query.api.service'.
14-02-2023 10:09:07.007 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.query.api.service' awaiting termination...
14-02-2023 10:09:07.219 [EmbeddedEventStore-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 10:09:07.220 [EmbeddedEventStore-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
14-02-2023 10:09:07.227 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 10:09:07.227 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
14-02-2023 10:09:07.226 [EmbeddedEventStore-0] ERROR org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.fetchData - Failed to read events from the underlying event storage
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:374)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.list(QuerySqmImpl.java:1073)
	at org.hibernate.query.Query.getResultList(Query.java:94)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchEvents(JpaEventStorageEngine.java:181)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:194)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:70)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:194)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:148)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:289)
	at java.base/java.util.Spliterator.forEachRemaining(Spliterator.java:332)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:261)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:227)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2800(EmbeddedEventStore.java:204)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:148)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.lambda$list$0(JdbcSelectExecutorStandardImpl.java:100)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:171)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.getResultSet(DeferredResultSetAccess.java:146)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.advanceNext(JdbcValuesResultSetImpl.java:205)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.processNext(JdbcValuesResultSetImpl.java:85)
	at org.hibernate.sql.results.jdbc.internal.AbstractJdbcValues.next(AbstractJdbcValues.java:29)
	at org.hibernate.sql.results.internal.RowProcessingStateStandardImpl.next(RowProcessingStateStandardImpl.java:88)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:197)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:33)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:443)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:166)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.list(JdbcSelectExecutorStandardImpl.java:91)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:31)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.lambda$new$0(ConcreteSqmSelectQueryPlan.java:113)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.withCacheableSqmInterpretation(ConcreteSqmSelectQueryPlan.java:335)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.performList(ConcreteSqmSelectQueryPlan.java:276)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doList(QuerySqmImpl.java:571)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:363)
	... 20 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTablePrimary(Parser.java:1863)
	at org.h2.command.Parser.readTableReference(Parser.java:2334)
	at org.h2.command.Parser.parseSelectFromPart(Parser.java:2772)
	at org.h2.command.Parser.parseSelect(Parser.java:2878)
	at org.h2.command.Parser.parseQueryPrimary(Parser.java:2762)
	at org.h2.command.Parser.parseQueryTerm(Parser.java:2633)
	at org.h2.command.Parser.parseQueryExpressionBody(Parser.java:2612)
	at org.h2.command.Parser.parseQueryExpressionBodyAndEndOfQuery(Parser.java:2605)
	at org.h2.command.Parser.parseQueryExpression(Parser.java:2598)
	at org.h2.command.Parser.parseQuery(Parser.java:2567)
	at org.h2.command.Parser.parsePrepared(Parser.java:724)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 39 common frames omitted
14-02-2023 10:09:07.228 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Error occurred. Starting retry mode.
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:175)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:709)
	at org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStore.extendClaim(JpaTokenStore.java:232)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$processBatch$13(TrackingEventProcessor.java:462)
	at org.axonframework.common.transaction.TransactionManager.executeInTransaction(TransactionManager.java:47)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:461)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.lambda$executeUpdate$0(SimpleUpdateQueryPlan.java:99)
	at org.hibernate.sql.exec.internal.StandardJdbcMutationExecutor.execute(StandardJdbcMutationExecutor.java:63)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.executeUpdate(SimpleUpdateQueryPlan.java:93)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doExecuteUpdate(QuerySqmImpl.java:728)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:698)
	... 9 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTableOrView(Parser.java:8328)
	at org.h2.command.Parser.readSimpleTableFilter(Parser.java:1160)
	at org.h2.command.Parser.parseUpdate(Parser.java:1118)
	at org.h2.command.Parser.parsePrepared(Parser.java:858)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 15 common frames omitted
14-02-2023 10:09:07.228 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Releasing claim on token and preparing for retry in 1s
14-02-2023 10:09:07.233 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 10:09:07.234 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 10:09:07.234 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 10:09:07.236 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 10:09:07.236 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 10:09:07.237 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 10:09:07.238 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Worker for segment Segment[0/0] stopped.
14-02-2023 10:09:07.265 [SpringApplicationShutdownHook] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.destroy - Closing JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 10:09:07.268 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown initiated...
14-02-2023 10:09:07.276 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown completed.
14-02-2023 10:09:24.458 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStarting - Starting EventSourcingCqrsApplicationTests using Java 17.0.6 with PID 11356 (started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 10:09:24.459 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 10:09:24.460 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 10:09:24.548 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 10:09:24.552 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:09:24.554 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:09:24.555 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:09:24.638 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:09:25.327 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 10:09:25.400 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 66 ms. Found 1 JPA repository interfaces.
14-02-2023 10:09:25.767 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 10:09:25.788 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.modelling.command.AggregateIdentifier with appropriate @AliasFor declarations: [routingKey]
14-02-2023 10:09:25.990 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 10:09:26.046 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 10:09:26.199 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 10:09:26.344 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 10:09:26.494 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 10:09:26.496 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 10:09:26.514 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 10:09:27.280 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 10:09:27.287 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 10:09:27.382 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 10:09:27.501 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 10:09:27.501 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 10:09:27.502 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 10:09:27.502 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 10:09:27.502 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 10:09:27.512 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 10:09:27.513 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 10:09:27.513 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 10:09:27.514 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/ParsingException
14-02-2023 10:09:27.906 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 10:09:28.404 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 10:09:28.427 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 10:09:28.818 [main] INFO  io.axoniq.axonserver.connector.impl.AxonServerManagedChannel.connectChannel - Requesting connection details from localhost:8124
14-02-2023 10:09:29.066 [main] INFO  io.axoniq.axonserver.connector.impl.AxonServerManagedChannel.createConnection - Successfully connected to localhost:8124
14-02-2023 10:09:29.074 [main] INFO  io.axoniq.axonserver.connector.impl.ControlChannelImpl.connect - Connected instruction stream for context 'default'. Sending client identification
14-02-2023 10:09:29.085 [main] INFO  io.axoniq.axonserver.connector.command.impl.CommandChannelImpl.lambda$doCreateCommandStream$7 - CommandChannel for context 'default' connected, 0 command handlers registered
14-02-2023 10:09:29.088 [main] INFO  io.axoniq.axonserver.connector.command.impl.CommandChannelImpl.registerCommandHandler - Registered handler for command 'com.example.eventsourcingcqrs.command.api.commands.CreateBankAccountCommand' in context 'default'
14-02-2023 10:09:29.091 [main] INFO  io.axoniq.axonserver.connector.command.impl.CommandChannelImpl.registerCommandHandler - Registered handler for command 'com.example.eventsourcingcqrs.command.api.commands.CreditMoneyCommand' in context 'default'
14-02-2023 10:09:29.092 [main] INFO  io.axoniq.axonserver.connector.command.impl.CommandChannelImpl.registerCommandHandler - Registered handler for command 'com.example.eventsourcingcqrs.command.api.commands.DebitMoneyCommand' in context 'default'
14-02-2023 10:09:29.117 [main] INFO  io.axoniq.axonserver.connector.query.impl.QueryChannelImpl.lambda$doConnectQueryStream$4 - QueryChannel for context 'default' connected, 0 registrations resubscribed
14-02-2023 10:09:29.123 [main] INFO  io.axoniq.axonserver.connector.query.impl.QueryChannelImpl.registerQueryHandler - Registered handler for query 'com.example.eventsourcingcqrs.query.api.model.QueryFindBankAccountById : com.example.eventsourcingcqrs.command.api.data.entity.BankAccount' in context 'default'
14-02-2023 10:09:29.244 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStarted - Started EventSourcingCqrsApplicationTests in 5.103 seconds (process running for 5.833)
14-02-2023 10:09:29.444 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.lambda$run$3 - Worker assigned to segment Segment[0/0] for processing
14-02-2023 10:09:29.452 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Using current Thread for last segment worker: TrackingSegmentWorker{processor=com.example.eventsourcingcqrs.query.api.service, segment=Segment[0/0]}
14-02-2023 10:09:29.456 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.ensureEventStreamOpened - Fetched token: null for segment: Segment[0/0]
14-02-2023 10:09:29.507 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.query.api.service'.
14-02-2023 10:09:29.508 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.query.api.service' awaiting termination...
14-02-2023 10:09:30.555 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 10:09:30.556 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set token=?,token_type=?,timestamp=? where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 10:09:30.560 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Error occurred. Starting retry mode.
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:175)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:709)
	at org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStore.storeToken(JpaTokenStore.java:151)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$processBatch$14(TrackingEventProcessor.java:469)
	at org.axonframework.common.transaction.TransactionManager.executeInTransaction(TransactionManager.java:47)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:468)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.lambda$executeUpdate$0(SimpleUpdateQueryPlan.java:99)
	at org.hibernate.sql.exec.internal.StandardJdbcMutationExecutor.execute(StandardJdbcMutationExecutor.java:63)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.executeUpdate(SimpleUpdateQueryPlan.java:93)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doExecuteUpdate(QuerySqmImpl.java:728)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:698)
	... 9 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set token=?,token_type=?,timestamp=? where owner=? and processor_name=? and segment=? [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTableOrView(Parser.java:8328)
	at org.h2.command.Parser.readSimpleTableFilter(Parser.java:1160)
	at org.h2.command.Parser.parseUpdate(Parser.java:1118)
	at org.h2.command.Parser.parsePrepared(Parser.java:858)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 15 common frames omitted
14-02-2023 10:09:30.562 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Releasing claim on token and preparing for retry in 1s
14-02-2023 10:09:30.567 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 10:09:30.567 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 10:09:30.568 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 10:09:30.570 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 10:09:30.570 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 10:09:30.571 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 10:09:30.573 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Worker for segment Segment[0/0] stopped.
14-02-2023 10:09:30.584 [SpringApplicationShutdownHook] INFO  io.axoniq.axonserver.connector.command.impl.CommandChannelImpl.unsubscribe - Deregistered handler for command 'com.example.eventsourcingcqrs.command.api.commands.CreateBankAccountCommand' in context 'default'
14-02-2023 10:09:30.585 [SpringApplicationShutdownHook] INFO  io.axoniq.axonserver.connector.command.impl.CommandChannelImpl.unsubscribe - Deregistered handler for command 'com.example.eventsourcingcqrs.command.api.commands.CreditMoneyCommand' in context 'default'
14-02-2023 10:09:30.585 [SpringApplicationShutdownHook] INFO  io.axoniq.axonserver.connector.command.impl.CommandChannelImpl.unsubscribe - Deregistered handler for command 'com.example.eventsourcingcqrs.command.api.commands.DebitMoneyCommand' in context 'default'
14-02-2023 10:09:31.107 [SpringApplicationShutdownHook] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.destroy - Closing JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 10:09:31.110 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown initiated...
14-02-2023 10:09:31.112 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown completed.
14-02-2023 10:10:28.243 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Starting EventSourcingCqrsApplication using Java 17.0.6 with PID 3412 (C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs\target\classes started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 10:10:28.245 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 10:10:28.245 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 10:10:28.330 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 10:10:28.336 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:10:28.336 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:10:28.339 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:10:28.395 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:10:28.917 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 10:10:28.999 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 77 ms. Found 1 JPA repository interfaces.
14-02-2023 10:10:29.279 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 10:10:29.458 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize - Tomcat initialized with port(s): 9090 (http)
14-02-2023 10:10:29.463 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Initializing ProtocolHandler ["http-nio-9090"]
14-02-2023 10:10:29.464 [main] INFO  org.apache.catalina.core.StandardService.log - Starting service [Tomcat]
14-02-2023 10:10:29.464 [main] INFO  org.apache.catalina.core.StandardEngine.log - Starting Servlet engine: [Apache Tomcat/10.1.5]
14-02-2023 10:10:29.530 [main] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring embedded WebApplicationContext
14-02-2023 10:10:29.531 [main] INFO  org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.prepareWebApplicationContext - Root WebApplicationContext: initialization completed in 1250 ms
14-02-2023 10:10:29.584 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 10:10:29.649 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 10:10:29.650 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 10:10:29.658 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 10:10:29.749 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 10:10:29.784 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 10:10:29.872 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 10:10:29.955 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 10:10:30.523 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 10:10:30.529 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 10:10:30.579 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 10:10:30.660 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 10:10:30.660 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 10:10:30.660 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 10:10:30.661 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 10:10:30.661 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 10:10:30.667 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 10:10:30.667 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 10:10:30.668 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 10:10:30.668 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 10:10:30.879 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 10:10:31.188 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 10:10:31.256 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Starting ProtocolHandler ["http-nio-9090"]
14-02-2023 10:10:31.274 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.start - Tomcat started on port(s): 9090 (http) with context path ''
14-02-2023 10:10:31.456 [main] INFO  io.axoniq.axonserver.connector.impl.AxonServerManagedChannel.connectChannel - Requesting connection details from localhost:8124
14-02-2023 10:10:31.641 [main] INFO  io.axoniq.axonserver.connector.impl.AxonServerManagedChannel.createConnection - Successfully connected to localhost:8124
14-02-2023 10:10:31.649 [main] INFO  io.axoniq.axonserver.connector.impl.ControlChannelImpl.connect - Connected instruction stream for context 'default'. Sending client identification
14-02-2023 10:10:31.658 [main] INFO  io.axoniq.axonserver.connector.command.impl.CommandChannelImpl.lambda$doCreateCommandStream$7 - CommandChannel for context 'default' connected, 0 command handlers registered
14-02-2023 10:10:31.659 [main] INFO  io.axoniq.axonserver.connector.command.impl.CommandChannelImpl.registerCommandHandler - Registered handler for command 'com.example.eventsourcingcqrs.command.api.commands.CreateBankAccountCommand' in context 'default'
14-02-2023 10:10:31.663 [main] INFO  io.axoniq.axonserver.connector.command.impl.CommandChannelImpl.registerCommandHandler - Registered handler for command 'com.example.eventsourcingcqrs.command.api.commands.CreditMoneyCommand' in context 'default'
14-02-2023 10:10:31.664 [main] INFO  io.axoniq.axonserver.connector.command.impl.CommandChannelImpl.registerCommandHandler - Registered handler for command 'com.example.eventsourcingcqrs.command.api.commands.DebitMoneyCommand' in context 'default'
14-02-2023 10:10:31.681 [main] INFO  io.axoniq.axonserver.connector.query.impl.QueryChannelImpl.lambda$doConnectQueryStream$4 - QueryChannel for context 'default' connected, 0 registrations resubscribed
14-02-2023 10:10:31.684 [main] INFO  io.axoniq.axonserver.connector.query.impl.QueryChannelImpl.registerQueryHandler - Registered handler for query 'com.example.eventsourcingcqrs.query.api.model.QueryFindBankAccountById : com.example.eventsourcingcqrs.command.api.data.entity.BankAccount' in context 'default'
14-02-2023 10:10:31.792 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarted - Started EventSourcingCqrsApplication in 4.039 seconds (process running for 4.617)
14-02-2023 10:10:31.874 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.lambda$run$3 - Worker assigned to segment Segment[0/0] for processing
14-02-2023 10:10:31.878 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Using current Thread for last segment worker: TrackingSegmentWorker{processor=com.example.eventsourcingcqrs.query.api.service, segment=Segment[0/0]}
14-02-2023 10:10:31.880 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.ensureEventStreamOpened - Fetched token: null for segment: Segment[0/0]
14-02-2023 10:13:11.691 [http-nio-9090-exec-10] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring DispatcherServlet 'dispatcherServlet'
14-02-2023 10:13:11.691 [http-nio-9090-exec-10] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Initializing Servlet 'dispatcherServlet'
14-02-2023 10:13:11.693 [http-nio-9090-exec-10] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Completed initialization in 1 ms
14-02-2023 10:13:29.472 [CommandProcessor-0] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.<init> - Une commande pour la création d'un nouveau compte bancaire [d372f828-9c91-4323-9c0b-f73dd8fe760e] a été effectué.
14-02-2023 10:13:40.766 [CommandProcessor-0] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°d372f828-9c91-4323-9c0b-f73dd8fe760e est en cours...
14-02-2023 10:13:48.037 [CommandProcessor-0] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°d372f828-9c91-4323-9c0b-f73dd8fe760e est en cours...
14-02-2023 10:13:50.314 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] DEBUG ProjectionBankAccountService.createBankAccount - Création en base du compte n°d372f828-9c91-4323-9c0b-f73dd8fe760e.
14-02-2023 10:13:55.655 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] DEBUG ProjectionBankAccountService.createBankAccount - Sauvegarde en base du compte n°d372f828-9c91-4323-9c0b-f73dd8fe760e.
14-02-2023 10:13:55.664 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] DEBUG ProjectionBankAccountService.activateBankAccount - Activation du compte en cours...
14-02-2023 10:14:11.520 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] DEBUG ProjectionBankAccountService.activateBankAccount - Compte n°d372f828-9c91-4323-9c0b-f73dd8fe760e activé, sauvegarde en base du nouveau statut.
14-02-2023 10:14:11.524 [grpc-default-executor-0] INFO  io.axoniq.axonserver.connector.impl.AxonServerManagedChannel.lambda$requestReconnect$5 - Reconnect for context default requested. Closing current connection.
14-02-2023 10:14:11.524 [grpc-default-executor-2] INFO  io.axoniq.axonserver.connector.query.impl.QueryChannelImpl.onConnectionError - Error on QueryChannel for context default
io.grpc.StatusRuntimeException: CANCELLED: RST_STREAM closed stream. HTTP/2 error code: CANCEL
	at io.grpc.Status.asRuntimeException(Status.java:539)
	at io.grpc.stub.ClientCalls$StreamObserverToCallListenerAdapter.onClose(ClientCalls.java:487)
	at io.grpc.internal.ClientCallImpl.closeObserver(ClientCallImpl.java:563)
	at io.grpc.internal.ClientCallImpl.access$300(ClientCallImpl.java:70)
	at io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInternal(ClientCallImpl.java:744)
	at io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInContext(ClientCallImpl.java:723)
	at io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
	at io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base/java.lang.Thread.run(Thread.java:833)
14-02-2023 10:14:11.528 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Error occurred. Starting retry mode.
org.axonframework.axonserver.connector.AxonServerException: The Event Stream has been closed, so no further events can be retrieved
	at org.axonframework.axonserver.connector.event.axon.EventBuffer.peekNullable(EventBuffer.java:178)
	at org.axonframework.axonserver.connector.event.axon.EventBuffer.hasNextAvailable(EventBuffer.java:144)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:418)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: io.grpc.StatusRuntimeException: CANCELLED: RST_STREAM closed stream. HTTP/2 error code: CANCEL
	at io.grpc.Status.asRuntimeException(Status.java:539)
	at io.grpc.stub.ClientCalls$StreamObserverToCallListenerAdapter.onClose(ClientCalls.java:487)
	at io.grpc.internal.ClientCallImpl.closeObserver(ClientCallImpl.java:563)
	at io.grpc.internal.ClientCallImpl.access$300(ClientCallImpl.java:70)
	at io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInternal(ClientCallImpl.java:744)
	at io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInContext(ClientCallImpl.java:723)
	at io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)
	at io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	... 1 common frames omitted
14-02-2023 10:14:11.528 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Releasing claim on token and preparing for retry in 1s
14-02-2023 10:14:11.532 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Released claim
14-02-2023 10:14:11.548 [axon-connector-3412@PC-LBL-1] INFO  io.axoniq.axonserver.connector.impl.AxonServerManagedChannel.connectChannel - Requesting connection details from localhost:8124
14-02-2023 10:14:11.553 [axon-connector-3412@PC-LBL-1] INFO  io.axoniq.axonserver.connector.impl.AxonServerManagedChannel.createConnection - Successfully connected to localhost:8124
14-02-2023 10:14:12.036 [axon-connector-3412@PC-LBL-0] INFO  io.axoniq.axonserver.connector.impl.ControlChannelImpl.connect - Connected instruction stream for context 'default'. Sending client identification
14-02-2023 10:14:12.040 [grpc-default-executor-0] INFO  io.axoniq.axonserver.connector.query.impl.QueryChannelImpl.lambda$doConnectQueryStream$4 - QueryChannel for context 'default' connected, 1 registrations resubscribed
14-02-2023 10:14:12.042 [grpc-default-executor-0] INFO  io.axoniq.axonserver.connector.command.impl.CommandChannelImpl.lambda$doCreateCommandStream$7 - CommandChannel for context 'default' connected, 3 command handlers registered
14-02-2023 10:14:12.544 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.ensureEventStreamOpened - Fetched token: IndexTrackingToken{globalIndex=9} for segment: Segment[0/0]
14-02-2023 10:17:22.745 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.query.api.service'.
14-02-2023 10:17:22.746 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.query.api.service' awaiting termination...
14-02-2023 10:17:54.256 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Starting EventSourcingCqrsApplication using Java 17.0.6 with PID 14720 (C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs\target\classes started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 10:17:54.257 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 10:17:54.258 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 10:17:54.337 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 10:17:54.342 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:17:54.343 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:17:54.344 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:17:54.404 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:17:54.914 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 10:17:54.985 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 64 ms. Found 1 JPA repository interfaces.
14-02-2023 10:17:55.292 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 10:17:55.484 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize - Tomcat initialized with port(s): 9090 (http)
14-02-2023 10:17:55.490 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Initializing ProtocolHandler ["http-nio-9090"]
14-02-2023 10:17:55.490 [main] INFO  org.apache.catalina.core.StandardService.log - Starting service [Tomcat]
14-02-2023 10:17:55.490 [main] INFO  org.apache.catalina.core.StandardEngine.log - Starting Servlet engine: [Apache Tomcat/10.1.5]
14-02-2023 10:17:55.555 [main] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring embedded WebApplicationContext
14-02-2023 10:17:55.555 [main] INFO  org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.prepareWebApplicationContext - Root WebApplicationContext: initialization completed in 1271 ms
14-02-2023 10:17:55.609 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 10:17:55.683 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 10:17:55.685 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 10:17:55.692 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 10:17:55.778 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 10:17:55.819 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 10:17:55.910 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 10:17:55.995 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 10:17:56.570 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 10:17:56.576 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 10:17:56.609 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 10:17:56.692 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 10:17:56.692 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 10:17:56.692 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 10:17:56.692 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 10:17:56.692 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 10:17:56.699 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 10:17:56.699 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 10:17:56.700 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 10:17:56.700 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 10:17:56.896 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 10:17:57.196 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 10:17:57.254 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Starting ProtocolHandler ["http-nio-9090"]
14-02-2023 10:17:57.269 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.start - Tomcat started on port(s): 9090 (http) with context path ''
14-02-2023 10:17:57.306 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarted - Started EventSourcingCqrsApplication in 3.456 seconds (process running for 4.023)
14-02-2023 10:17:57.583 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.lambda$run$3 - Worker assigned to segment Segment[0/0] for processing
14-02-2023 10:17:57.589 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Using current Thread for last segment worker: TrackingSegmentWorker{processor=com.example.eventsourcingcqrs.query.api.service, segment=Segment[0/0]}
14-02-2023 10:17:57.591 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.ensureEventStreamOpened - Fetched token: null for segment: Segment[0/0]
14-02-2023 10:18:25.344 [http-nio-9090-exec-1] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring DispatcherServlet 'dispatcherServlet'
14-02-2023 10:18:25.344 [http-nio-9090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Initializing Servlet 'dispatcherServlet'
14-02-2023 10:18:25.346 [http-nio-9090-exec-1] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Completed initialization in 2 ms
14-02-2023 10:18:42.746 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.<init> - Une commande pour la création d'un nouveau compte bancaire [85701c16-7c5b-4c8c-9ff1-2652a3fbf569] a été effectué.
14-02-2023 10:18:44.678 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°85701c16-7c5b-4c8c-9ff1-2652a3fbf569 est en cours...
14-02-2023 10:18:47.177 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°85701c16-7c5b-4c8c-9ff1-2652a3fbf569 est en cours...
14-02-2023 10:18:47.234 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] DEBUG ProjectionBankAccountService.createBankAccount - Création en base du compte n°85701c16-7c5b-4c8c-9ff1-2652a3fbf569.
14-02-2023 10:19:05.881 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] DEBUG ProjectionBankAccountService.createBankAccount - Sauvegarde en base du compte n°85701c16-7c5b-4c8c-9ff1-2652a3fbf569.
14-02-2023 10:19:05.911 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] DEBUG ProjectionBankAccountService.activateBankAccount - Activation du compte en cours...
14-02-2023 10:19:15.913 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] DEBUG ProjectionBankAccountService.activateBankAccount - Compte n°85701c16-7c5b-4c8c-9ff1-2652a3fbf569 activé, sauvegarde en base du nouveau statut.
14-02-2023 10:20:23.136 [http-nio-9090-exec-8] DEBUG ProjectionBankAccountService.findBankAccountById - Rechercher un compte bancaire par son ID.
14-02-2023 10:20:23.138 [http-nio-9090-exec-8] DEBUG ProjectionBankAccountService.findBankAccountById - Compte bancaire trouver.
14-02-2023 10:20:28.991 [http-nio-9090-exec-3] DEBUG ProjectionBankAccountService.findBankAccountById - Rechercher un compte bancaire par son ID.
14-02-2023 10:20:28.992 [http-nio-9090-exec-3] ERROR ProjectionBankAccountService.findBankAccountById - Le compte bancaire n° 85701c16-7c5b-4c8c-9ff1-2652a3fbf56 n'existe pas.
14-02-2023 10:20:28.998 [http-nio-9090-exec-3] ERROR org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].[dispatcherServlet].log - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: java.util.concurrent.CompletionException: com.example.eventsourcingcqrs.exception.AccountNotFoundException: Le numéro de compte bancaire 85701c16-7c5b-4c8c-9ff1-2652a3fbf56 n'existe pas] with root cause
com.example.eventsourcingcqrs.exception.AccountNotFoundException: Le numéro de compte bancaire 85701c16-7c5b-4c8c-9ff1-2652a3fbf56 n'existe pas
	at ProjectionBankAccountService.findBankAccountById(ProjectionBankAccountService.java:134)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.axonframework.messaging.annotation.AnnotatedMessageHandlingMember.handle(AnnotatedMessageHandlingMember.java:153)
	at org.axonframework.messaging.annotation.WrappedMessageHandlingMember.handle(WrappedMessageHandlingMember.java:64)
	at org.axonframework.queryhandling.annotation.MethodQueryMessageHandlerDefinition$MethodQueryMessageHandlingMember.handle(MethodQueryMessageHandlerDefinition.java:93)
	at org.axonframework.messaging.annotation.WrappedMessageHandlingMember.handle(WrappedMessageHandlingMember.java:64)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.lambda$handle$1(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.tracing.Span.runCallable(Span.java:103)
	at org.axonframework.tracing.TracingHandlerEnhancerDefinition$1.handle(TracingHandlerEnhancerDefinition.java:84)
	at org.axonframework.messaging.annotation.AnnotatedHandlerInspector$NoMoreInterceptors.handle(AnnotatedHandlerInspector.java:386)
	at org.axonframework.queryhandling.annotation.AnnotationQueryHandlerAdapter.handle(AnnotationQueryHandlerAdapter.java:118)
	at org.axonframework.queryhandling.annotation.AnnotationQueryHandlerAdapter.handle(AnnotationQueryHandlerAdapter.java:45)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:57)
	at org.axonframework.messaging.interceptors.TransactionManagingInterceptor.handle(TransactionManagingInterceptor.java:53)
	at org.axonframework.messaging.DefaultInterceptorChain.proceed(DefaultInterceptorChain.java:55)
	at org.axonframework.queryhandling.SimpleQueryBus.lambda$interceptAndInvoke$22(SimpleQueryBus.java:445)
	at org.axonframework.messaging.unitofwork.DefaultUnitOfWork.executeWithResult(DefaultUnitOfWork.java:77)
	at org.axonframework.messaging.unitofwork.UnitOfWork.executeWithResult(UnitOfWork.java:329)
	at org.axonframework.queryhandling.SimpleQueryBus.interceptAndInvoke(SimpleQueryBus.java:443)
	at org.axonframework.queryhandling.SimpleQueryBus.doQuery(SimpleQueryBus.java:199)
	at org.axonframework.queryhandling.SimpleQueryBus.query(SimpleQueryBus.java:172)
	at org.axonframework.queryhandling.DefaultQueryGateway.query(DefaultQueryGateway.java:84)
	at org.axonframework.queryhandling.QueryGateway.query(QueryGateway.java:75)
	at org.axonframework.queryhandling.QueryGateway.query(QueryGateway.java:57)
	at com.example.eventsourcingcqrs.query.api.controller.QueryBankAccountController.findBankAccountById(QueryBankAccountController.java:33)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:207)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:152)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:117)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:884)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:797)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1080)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:973)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1011)
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:705)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:814)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:223)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:158)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:185)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:158)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:185)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:158)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:185)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:158)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:185)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:158)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:185)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:158)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:177)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:97)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:542)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:119)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:78)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:357)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:400)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:859)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1734)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:833)
14-02-2023 10:21:28.112 [http-nio-9090-exec-9] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.modelling.command.AggregateIdentifier with appropriate @AliasFor declarations: [routingKey]
14-02-2023 10:21:43.094 [http-nio-9090-exec-9] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°85701c16-7c5b-4c8c-9ff1-2652a3fbf569 est en cours...
14-02-2023 10:21:51.243 [http-nio-9090-exec-9] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°85701c16-7c5b-4c8c-9ff1-2652a3fbf569 est en cours...
14-02-2023 10:21:51.246 [http-nio-9090-exec-9] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - Une commande pour un dépôt d'argent d'un montant de 3000 sur le compte bancaire n°85701c16-7c5b-4c8c-9ff1-2652a3fbf569 a été effectué.
14-02-2023 10:21:51.247 [http-nio-9090-exec-9] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - Une demande de dépôt d'argent sur le compte bancaire n°85701c16-7c5b-4c8c-9ff1-2652a3fbf569 est en cours...
14-02-2023 10:21:55.922 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] DEBUG ProjectionBankAccountService.depositMoneyInBankAccount - Ajout en base d'un dépôt d'argent d'un montant de 3000 sur le compte.
14-02-2023 10:21:55.923 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] DEBUG ProjectionBankAccountService.depositMoneyInBankAccount - Sauvegarde en base du nouveau solde suite au dépôt effectué sur le compte n°85701c16-7c5b-4c8c-9ff1-2652a3fbf569.
14-02-2023 10:22:15.569 [http-nio-9090-exec-10] DEBUG ProjectionBankAccountService.findBankAccountById - Rechercher un compte bancaire par son ID.
14-02-2023 10:22:15.570 [http-nio-9090-exec-10] DEBUG ProjectionBankAccountService.findBankAccountById - Compte bancaire trouver.
14-02-2023 10:22:43.761 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°85701c16-7c5b-4c8c-9ff1-2652a3fbf569 est en cours...
14-02-2023 10:22:45.412 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°85701c16-7c5b-4c8c-9ff1-2652a3fbf569 est en cours...
14-02-2023 10:22:45.412 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - Une demande de dépôt d'argent sur le compte bancaire n°85701c16-7c5b-4c8c-9ff1-2652a3fbf569 est en cours...
14-02-2023 10:22:45.413 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - Une commande pour un retrait d'argent d'un montant de 2000 sur le compte bancaire n°85701c16-7c5b-4c8c-9ff1-2652a3fbf569 a été effectué.
14-02-2023 10:22:45.413 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - Une demande de retrait sur le compte bancaire n°85701c16-7c5b-4c8c-9ff1-2652a3fbf569 est en cours...
14-02-2023 10:22:45.417 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] DEBUG ProjectionBankAccountService.withdrawalMoneyFromBankAccount - Retrait d'argent en base d'un montant de 2000 sur le compte.
14-02-2023 10:22:45.418 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] DEBUG ProjectionBankAccountService.withdrawalMoneyFromBankAccount - Sauvegarde en base du nouveau solde suite au retrait effectué sur le compte n°85701c16-7c5b-4c8c-9ff1-2652a3fbf569.
14-02-2023 10:22:57.955 [http-nio-9090-exec-2] DEBUG ProjectionBankAccountService.findBankAccountById - Rechercher un compte bancaire par son ID.
14-02-2023 10:22:57.956 [http-nio-9090-exec-2] DEBUG ProjectionBankAccountService.findBankAccountById - Compte bancaire trouver.
14-02-2023 10:24:15.294 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.query.api.service'.
14-02-2023 10:24:15.295 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.query.api.service' awaiting termination...
14-02-2023 10:24:15.501 [EmbeddedEventStore-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 10:24:15.501 [EmbeddedEventStore-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
14-02-2023 10:24:15.507 [EmbeddedEventStore-0] ERROR org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.fetchData - Failed to read events from the underlying event storage
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:374)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.list(QuerySqmImpl.java:1073)
	at org.hibernate.query.Query.getResultList(Query.java:94)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchEvents(JpaEventStorageEngine.java:181)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:194)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:70)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:194)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:148)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:289)
	at java.base/java.util.Spliterator.forEachRemaining(Spliterator.java:332)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:261)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:227)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2800(EmbeddedEventStore.java:204)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:148)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.lambda$list$0(JdbcSelectExecutorStandardImpl.java:100)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:171)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.getResultSet(DeferredResultSetAccess.java:146)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.advanceNext(JdbcValuesResultSetImpl.java:205)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.processNext(JdbcValuesResultSetImpl.java:85)
	at org.hibernate.sql.results.jdbc.internal.AbstractJdbcValues.next(AbstractJdbcValues.java:29)
	at org.hibernate.sql.results.internal.RowProcessingStateStandardImpl.next(RowProcessingStateStandardImpl.java:88)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:197)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:33)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:443)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:166)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.list(JdbcSelectExecutorStandardImpl.java:91)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:31)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.lambda$new$0(ConcreteSqmSelectQueryPlan.java:113)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.withCacheableSqmInterpretation(ConcreteSqmSelectQueryPlan.java:335)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.performList(ConcreteSqmSelectQueryPlan.java:276)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doList(QuerySqmImpl.java:571)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:363)
	... 20 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTablePrimary(Parser.java:1863)
	at org.h2.command.Parser.readTableReference(Parser.java:2334)
	at org.h2.command.Parser.parseSelectFromPart(Parser.java:2772)
	at org.h2.command.Parser.parseSelect(Parser.java:2878)
	at org.h2.command.Parser.parseQueryPrimary(Parser.java:2762)
	at org.h2.command.Parser.parseQueryTerm(Parser.java:2633)
	at org.h2.command.Parser.parseQueryExpressionBody(Parser.java:2612)
	at org.h2.command.Parser.parseQueryExpressionBodyAndEndOfQuery(Parser.java:2605)
	at org.h2.command.Parser.parseQueryExpression(Parser.java:2598)
	at org.h2.command.Parser.parseQuery(Parser.java:2567)
	at org.h2.command.Parser.parsePrepared(Parser.java:724)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 39 common frames omitted
14-02-2023 10:24:15.507 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 10:24:15.507 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
14-02-2023 10:24:15.508 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Error occurred. Starting retry mode.
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:175)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:709)
	at org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStore.extendClaim(JpaTokenStore.java:232)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$processBatch$13(TrackingEventProcessor.java:462)
	at org.axonframework.common.transaction.TransactionManager.executeInTransaction(TransactionManager.java:47)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:461)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.lambda$executeUpdate$0(SimpleUpdateQueryPlan.java:99)
	at org.hibernate.sql.exec.internal.StandardJdbcMutationExecutor.execute(StandardJdbcMutationExecutor.java:63)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.executeUpdate(SimpleUpdateQueryPlan.java:93)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doExecuteUpdate(QuerySqmImpl.java:728)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:698)
	... 9 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTableOrView(Parser.java:8328)
	at org.h2.command.Parser.readSimpleTableFilter(Parser.java:1160)
	at org.h2.command.Parser.parseUpdate(Parser.java:1118)
	at org.h2.command.Parser.parsePrepared(Parser.java:858)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 15 common frames omitted
14-02-2023 10:24:15.508 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Releasing claim on token and preparing for retry in 1s
14-02-2023 10:24:15.510 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 10:24:15.511 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 10:24:15.511 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 10:24:15.511 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 10:24:15.512 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 10:24:15.512 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 10:24:15.512 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Worker for segment Segment[0/0] stopped.
14-02-2023 10:24:15.533 [SpringApplicationShutdownHook] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.destroy - Closing JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 10:24:15.535 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown initiated...
14-02-2023 10:24:15.543 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown completed.
14-02-2023 10:24:18.249 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Starting EventSourcingCqrsApplication using Java 17.0.6 with PID 3220 (C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs\target\classes started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 10:24:18.250 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 10:24:18.251 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 10:24:18.328 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 10:24:18.333 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:24:18.334 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:24:18.336 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:24:18.350 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 10:24:18.850 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 10:24:18.931 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 73 ms. Found 1 JPA repository interfaces.
14-02-2023 10:24:19.218 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 10:24:19.397 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize - Tomcat initialized with port(s): 9090 (http)
14-02-2023 10:24:19.403 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Initializing ProtocolHandler ["http-nio-9090"]
14-02-2023 10:24:19.404 [main] INFO  org.apache.catalina.core.StandardService.log - Starting service [Tomcat]
14-02-2023 10:24:19.404 [main] INFO  org.apache.catalina.core.StandardEngine.log - Starting Servlet engine: [Apache Tomcat/10.1.5]
14-02-2023 10:24:19.465 [main] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring embedded WebApplicationContext
14-02-2023 10:24:19.466 [main] INFO  org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.prepareWebApplicationContext - Root WebApplicationContext: initialization completed in 1188 ms
14-02-2023 10:24:19.520 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 10:24:19.586 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 10:24:19.587 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 10:24:19.595 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 10:24:19.679 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 10:24:19.719 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 10:24:19.808 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 10:24:19.892 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 10:24:20.462 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 10:24:20.468 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 10:24:20.501 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 10:24:20.578 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 10:24:20.578 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 10:24:20.578 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 10:24:20.578 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 10:24:20.578 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 10:24:20.585 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 10:24:20.585 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 10:24:20.586 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 10:24:20.586 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 10:24:20.775 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 10:24:21.084 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 10:24:21.145 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Starting ProtocolHandler ["http-nio-9090"]
14-02-2023 10:24:21.159 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.start - Tomcat started on port(s): 9090 (http) with context path ''
14-02-2023 10:24:21.200 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarted - Started EventSourcingCqrsApplication in 3.317 seconds (process running for 3.82)
14-02-2023 10:24:21.440 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.lambda$run$3 - Worker assigned to segment Segment[0/0] for processing
14-02-2023 10:24:21.444 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Using current Thread for last segment worker: TrackingSegmentWorker{processor=com.example.eventsourcingcqrs.query.api.service, segment=Segment[0/0]}
14-02-2023 10:24:21.446 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.ensureEventStreamOpened - Fetched token: null for segment: Segment[0/0]
14-02-2023 12:08:01.946 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.query.api.service'.
14-02-2023 12:08:01.946 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.query.api.service' awaiting termination...
14-02-2023 12:08:02.574 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 12:08:02.574 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
14-02-2023 12:08:02.590 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Error occurred. Starting retry mode.
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:175)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:709)
	at org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStore.extendClaim(JpaTokenStore.java:232)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$processBatch$13(TrackingEventProcessor.java:462)
	at org.axonframework.common.transaction.TransactionManager.executeInTransaction(TransactionManager.java:47)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:461)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.lambda$executeUpdate$0(SimpleUpdateQueryPlan.java:99)
	at org.hibernate.sql.exec.internal.StandardJdbcMutationExecutor.execute(StandardJdbcMutationExecutor.java:63)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.executeUpdate(SimpleUpdateQueryPlan.java:93)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doExecuteUpdate(QuerySqmImpl.java:728)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:698)
	... 9 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTableOrView(Parser.java:8328)
	at org.h2.command.Parser.readSimpleTableFilter(Parser.java:1160)
	at org.h2.command.Parser.parseUpdate(Parser.java:1118)
	at org.h2.command.Parser.parsePrepared(Parser.java:858)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 15 common frames omitted
14-02-2023 12:08:02.590 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Releasing claim on token and preparing for retry in 1s
14-02-2023 12:08:02.590 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 12:08:02.590 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 12:08:02.606 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 12:08:02.606 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 12:08:02.606 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 12:08:02.606 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 12:08:02.606 [EventProcessor[com.example.eventsourcingcqrs.query.api.service]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Worker for segment Segment[0/0] stopped.
14-02-2023 12:08:02.637 [SpringApplicationShutdownHook] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.destroy - Closing JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 12:08:02.637 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown initiated...
14-02-2023 12:08:02.653 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown completed.
14-02-2023 12:29:36.727 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStarting - Starting EventSourcingCqrsApplicationTests using Java 17.0.6 with PID 24292 (started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 12:29:36.727 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 12:29:36.727 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 12:29:36.814 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 12:29:36.829 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 12:29:36.829 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 12:29:36.829 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 12:29:36.892 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 12:29:37.571 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 12:29:37.650 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 80 ms. Found 1 JPA repository interfaces.
14-02-2023 12:29:38.042 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 12:29:38.057 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.modelling.command.AggregateIdentifier with appropriate @AliasFor declarations: [routingKey]
14-02-2023 12:29:38.277 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 12:29:38.340 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 12:29:38.528 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 12:29:38.685 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 12:29:38.873 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 12:29:38.873 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 12:29:38.889 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 12:29:39.642 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 12:29:39.642 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 12:29:39.704 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 12:29:39.830 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 12:29:39.830 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 12:29:39.830 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 12:29:39.830 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 12:29:39.830 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 12:29:39.846 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 12:29:39.846 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 12:29:39.846 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 12:29:39.846 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/ParsingException
14-02-2023 12:29:40.206 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 12:29:40.649 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 12:29:40.664 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 12:29:40.774 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStarted - Started EventSourcingCqrsApplicationTests in 4.38 seconds (process running for 5.128)
14-02-2023 12:29:41.044 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.query.api.controller.projection'.
14-02-2023 12:29:41.044 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.query.api.controller.projection' awaiting termination...
14-02-2023 12:29:41.059 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 90121, SQLState: 90121
14-02-2023 12:29:41.059 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - La base de donnes est dj ferme (pour dsactiver la fermeture automatique  l'arrt de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE"  l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
14-02-2023 12:29:41.059 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 90121, SQLState: 90121
14-02-2023 12:29:41.059 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - La base de donnes est dj ferme (pour dsactiver la fermeture automatique  l'arrt de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE"  l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
14-02-2023 12:29:41.059 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] ERROR org.springframework.orm.jpa.EntityManagerFactoryUtils.closeEntityManager - Failed to release JPA EntityManager
org.hibernate.exception.JDBCConnectionException: Unable to release JDBC Connection
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:49)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:95)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.releaseConnection(LogicalConnectionManagedImpl.java:222)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.close(LogicalConnectionManagedImpl.java:252)
	at org.hibernate.engine.jdbc.internal.JdbcCoordinatorImpl.close(JdbcCoordinatorImpl.java:170)
	at org.hibernate.internal.AbstractSharedSessionContract.close(AbstractSharedSessionContract.java:376)
	at org.hibernate.internal.SessionImpl.closeWithoutOpenChecks(SessionImpl.java:404)
	at org.hibernate.internal.SessionImpl.close(SessionImpl.java:389)
	at org.springframework.orm.jpa.EntityManagerFactoryUtils.closeEntityManager(EntityManagerFactoryUtils.java:424)
	at org.springframework.orm.jpa.JpaTransactionManager.doCleanupAfterCompletion(JpaTransactionManager.java:650)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.cleanupAfterCompletion(AbstractPlatformTransactionManager.java:992)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processRollback(AbstractPlatformTransactionManager.java:875)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.rollback(AbstractPlatformTransactionManager.java:809)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager.rollbackTransaction(SpringTransactionManager.java:97)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager$1.rollback(SpringTransactionManager.java:74)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:74)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1210)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.h2.jdbc.JdbcSQLNonTransientConnectionException: La base de donnes est dj ferme (pour dsactiver la fermeture automatique  l'arrt de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE"  l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:678)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.get(DbException.java:188)
	at org.h2.jdbc.JdbcConnection.checkClosed(JdbcConnection.java:1375)
	at org.h2.jdbc.JdbcConnection.setAutoCommit(JdbcConnection.java:402)
	at com.zaxxer.hikari.pool.PoolBase.resetConnectionState(PoolBase.java:214)
	at com.zaxxer.hikari.pool.PoolEntry.resetConnectionState(PoolEntry.java:106)
	at com.zaxxer.hikari.pool.ProxyConnection.close(ProxyConnection.java:254)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.closeConnection(DatasourceConnectionProviderImpl.java:127)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.releaseConnection(NonContextualJdbcConnectionAccess.java:49)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.releaseConnection(LogicalConnectionManagedImpl.java:218)
	... 15 common frames omitted
14-02-2023 12:29:41.059 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.run - Fetch Segments for Processor 'com.example.eventsourcingcqrs.query.api.controller.projection' failed: Could not roll back JPA transaction. Preparing for retry in 1s
org.springframework.transaction.TransactionSystemException: Could not roll back JPA transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doRollback(JpaTransactionManager.java:593)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processRollback(AbstractPlatformTransactionManager.java:835)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.rollback(AbstractPlatformTransactionManager.java:809)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager.rollbackTransaction(SpringTransactionManager.java:97)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager$1.rollback(SpringTransactionManager.java:74)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:74)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1210)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.TransactionException: Unable to rollback against JDBC Connection
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.rollback(AbstractLogicalConnectionImplementor.java:127)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.rollback(JdbcResourceLocalTransactionCoordinatorImpl.java:304)
	at org.hibernate.engine.transaction.internal.TransactionImpl.rollback(TransactionImpl.java:142)
	at org.springframework.orm.jpa.JpaTransactionManager.doRollback(JpaTransactionManager.java:589)
	... 7 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLNonTransientConnectionException: La base de donnes est dj ferme (pour dsactiver la fermeture automatique  l'arrt de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE"  l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:678)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.get(DbException.java:188)
	at org.h2.jdbc.JdbcConnection.checkClosed(JdbcConnection.java:1375)
	at org.h2.jdbc.JdbcConnection.rollback(JdbcConnection.java:463)
	at com.zaxxer.hikari.pool.ProxyConnection.rollback(ProxyConnection.java:385)
	at com.zaxxer.hikari.pool.HikariProxyConnection.rollback(HikariProxyConnection.java)
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.rollback(AbstractLogicalConnectionImplementor.java:121)
	... 10 common frames omitted
14-02-2023 12:29:41.075 [SpringApplicationShutdownHook] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.destroy - Closing JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 12:29:41.075 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown initiated...
14-02-2023 12:29:41.075 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown completed.
14-02-2023 12:29:53.767 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStarting - Starting EventSourcingCqrsApplicationTests using Java 17.0.6 with PID 19880 (started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 12:29:53.767 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 12:29:53.767 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 12:29:53.846 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 12:29:53.861 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 12:29:53.861 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 12:29:53.861 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 12:29:53.923 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 12:29:54.587 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 12:29:54.666 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 73 ms. Found 1 JPA repository interfaces.
14-02-2023 12:29:55.011 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 12:29:55.042 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.modelling.command.AggregateIdentifier with appropriate @AliasFor declarations: [routingKey]
14-02-2023 12:29:55.248 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 12:29:55.309 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 12:29:55.466 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 12:29:55.623 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 12:29:55.780 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 12:29:55.780 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 12:29:55.795 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 12:29:56.501 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 12:29:56.517 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 12:29:56.564 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 12:29:56.689 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 12:29:56.689 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 12:29:56.689 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 12:29:56.689 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 12:29:56.689 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 12:29:56.689 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 12:29:56.689 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 12:29:56.689 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 12:29:56.705 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/ParsingException
14-02-2023 12:29:57.052 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 12:29:57.521 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 12:29:57.537 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 12:29:57.678 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplicationTests.logStarted - Started EventSourcingCqrsApplicationTests in 4.223 seconds (process running for 4.972)
14-02-2023 12:29:57.938 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.query.api.controller.projection'.
14-02-2023 12:29:57.938 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.query.api.controller.projection' awaiting termination...
14-02-2023 12:29:57.969 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 90121, SQLState: 90121
14-02-2023 12:29:57.969 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - La base de donnes est dj ferme (pour dsactiver la fermeture automatique  l'arrt de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE"  l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
14-02-2023 12:29:57.969 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 90121, SQLState: 90121
14-02-2023 12:29:57.969 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - La base de donnes est dj ferme (pour dsactiver la fermeture automatique  l'arrt de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE"  l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
14-02-2023 12:29:57.969 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] ERROR org.springframework.orm.jpa.EntityManagerFactoryUtils.closeEntityManager - Failed to release JPA EntityManager
org.hibernate.exception.JDBCConnectionException: Unable to release JDBC Connection
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:49)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:95)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.releaseConnection(LogicalConnectionManagedImpl.java:222)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.close(LogicalConnectionManagedImpl.java:252)
	at org.hibernate.engine.jdbc.internal.JdbcCoordinatorImpl.close(JdbcCoordinatorImpl.java:170)
	at org.hibernate.internal.AbstractSharedSessionContract.close(AbstractSharedSessionContract.java:376)
	at org.hibernate.internal.SessionImpl.closeWithoutOpenChecks(SessionImpl.java:404)
	at org.hibernate.internal.SessionImpl.close(SessionImpl.java:389)
	at org.springframework.orm.jpa.EntityManagerFactoryUtils.closeEntityManager(EntityManagerFactoryUtils.java:424)
	at org.springframework.orm.jpa.JpaTransactionManager.doCleanupAfterCompletion(JpaTransactionManager.java:650)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.cleanupAfterCompletion(AbstractPlatformTransactionManager.java:992)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processRollback(AbstractPlatformTransactionManager.java:875)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.rollback(AbstractPlatformTransactionManager.java:809)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager.rollbackTransaction(SpringTransactionManager.java:97)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager$1.rollback(SpringTransactionManager.java:74)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:74)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1210)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.h2.jdbc.JdbcSQLNonTransientConnectionException: La base de donnes est dj ferme (pour dsactiver la fermeture automatique  l'arrt de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE"  l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:678)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.get(DbException.java:188)
	at org.h2.jdbc.JdbcConnection.checkClosed(JdbcConnection.java:1375)
	at org.h2.jdbc.JdbcConnection.setAutoCommit(JdbcConnection.java:402)
	at com.zaxxer.hikari.pool.PoolBase.resetConnectionState(PoolBase.java:214)
	at com.zaxxer.hikari.pool.PoolEntry.resetConnectionState(PoolEntry.java:106)
	at com.zaxxer.hikari.pool.ProxyConnection.close(ProxyConnection.java:254)
	at org.hibernate.engine.jdbc.connections.internal.DatasourceConnectionProviderImpl.closeConnection(DatasourceConnectionProviderImpl.java:127)
	at org.hibernate.internal.NonContextualJdbcConnectionAccess.releaseConnection(NonContextualJdbcConnectionAccess.java:49)
	at org.hibernate.resource.jdbc.internal.LogicalConnectionManagedImpl.releaseConnection(LogicalConnectionManagedImpl.java:218)
	... 15 common frames omitted
14-02-2023 12:29:57.984 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.run - Fetch Segments for Processor 'com.example.eventsourcingcqrs.query.api.controller.projection' failed: Could not roll back JPA transaction. Preparing for retry in 1s
org.springframework.transaction.TransactionSystemException: Could not roll back JPA transaction
	at org.springframework.orm.jpa.JpaTransactionManager.doRollback(JpaTransactionManager.java:593)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processRollback(AbstractPlatformTransactionManager.java:835)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.rollback(AbstractPlatformTransactionManager.java:809)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager.rollbackTransaction(SpringTransactionManager.java:97)
	at org.axonframework.spring.messaging.unitofwork.SpringTransactionManager$1.rollback(SpringTransactionManager.java:74)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:74)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1210)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.TransactionException: Unable to rollback against JDBC Connection
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.rollback(AbstractLogicalConnectionImplementor.java:127)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.rollback(JdbcResourceLocalTransactionCoordinatorImpl.java:304)
	at org.hibernate.engine.transaction.internal.TransactionImpl.rollback(TransactionImpl.java:142)
	at org.springframework.orm.jpa.JpaTransactionManager.doRollback(JpaTransactionManager.java:589)
	... 7 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLNonTransientConnectionException: La base de donnes est dj ferme (pour dsactiver la fermeture automatique  l'arrt de la VM, ajoutez "; DB_CLOSE_ON_EXIT = FALSE"  l'URL db)
Database is already closed (to disable automatic closing at VM shutdown, add ";DB_CLOSE_ON_EXIT=FALSE" to the db URL) [90121-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:678)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.message.DbException.get(DbException.java:188)
	at org.h2.jdbc.JdbcConnection.checkClosed(JdbcConnection.java:1375)
	at org.h2.jdbc.JdbcConnection.rollback(JdbcConnection.java:463)
	at com.zaxxer.hikari.pool.ProxyConnection.rollback(ProxyConnection.java:385)
	at com.zaxxer.hikari.pool.HikariProxyConnection.rollback(HikariProxyConnection.java)
	at org.hibernate.resource.jdbc.internal.AbstractLogicalConnectionImplementor.rollback(AbstractLogicalConnectionImplementor.java:121)
	... 10 common frames omitted
14-02-2023 12:29:58.000 [SpringApplicationShutdownHook] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.destroy - Closing JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 12:29:58.000 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown initiated...
14-02-2023 12:29:58.000 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown completed.
14-02-2023 12:31:04.416 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Starting EventSourcingCqrsApplication using Java 17.0.6 with PID 23756 (C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs\target\classes started by l.blois in C:\Users\l.blois\IdeaProjectPerso\event-sourcing-cqrs)
14-02-2023 12:31:04.417 [main] DEBUG com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarting - Running with Spring Boot v3.0.2, Spring v6.0.4
14-02-2023 12:31:04.417 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStartupProfileInfo - No active profile set, falling back to 1 default profile: "default"
14-02-2023 12:31:04.487 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.spring.stereotype.Aggregate with appropriate @AliasFor declarations: [type]
14-02-2023 12:31:04.503 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 12:31:04.503 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventsourcing.EventSourcingHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 12:31:04.503 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.commandhandling.CommandHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 12:31:04.530 [main] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.eventhandling.EventHandler with appropriate @AliasFor declarations: [payloadType]
14-02-2023 12:31:05.038 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
14-02-2023 12:31:05.100 [main] INFO  org.springframework.data.repository.config.RepositoryConfigurationDelegate.registerRepositoriesIn - Finished Spring Data repository scanning in 62 ms. Found 1 JPA repository interfaces.
14-02-2023 12:31:05.399 [main] WARN  org.springframework.core.LocalVariableTableParameterNameDiscoverer.inspectClass - Using deprecated '-debug' fallback for parameter name resolution. Compile the affected code with '-parameters' instead or avoid its introspection: org.axonframework.spring.eventsourcing.SpringPrototypeAggregateFactory
14-02-2023 12:31:05.572 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.initialize - Tomcat initialized with port(s): 9090 (http)
14-02-2023 12:31:05.572 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Initializing ProtocolHandler ["http-nio-9090"]
14-02-2023 12:31:05.572 [main] INFO  org.apache.catalina.core.StandardService.log - Starting service [Tomcat]
14-02-2023 12:31:05.572 [main] INFO  org.apache.catalina.core.StandardEngine.log - Starting Servlet engine: [Apache Tomcat/10.1.5]
14-02-2023 12:31:05.635 [main] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring embedded WebApplicationContext
14-02-2023 12:31:05.635 [main] INFO  org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.prepareWebApplicationContext - Root WebApplicationContext: initialization completed in 1200 ms
14-02-2023 12:31:05.697 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Starting...
14-02-2023 12:31:05.791 [main] INFO  com.zaxxer.hikari.pool.HikariPool.checkFailFast - HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:accountDb user=LOIC
14-02-2023 12:31:05.791 [main] INFO  com.zaxxer.hikari.HikariDataSource.getConnection - HikariPool-1 - Start completed.
14-02-2023 12:31:05.807 [main] INFO  org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration.logDataSources - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:accountDb'
14-02-2023 12:31:05.948 [main] INFO  org.hibernate.jpa.internal.util.LogHelper.logPersistenceUnitInformation - HHH000204: Processing PersistenceUnitInfo [name: default]
14-02-2023 12:31:06.012 [main] INFO  org.hibernate.Version.logVersion - HHH000412: Hibernate ORM core version 6.1.6.Final
14-02-2023 12:31:06.090 [main] WARN  org.hibernate.orm.deprecation.lambda$new$1 - HHH90000021: Encountered deprecated setting [javax.persistence.sharedCache.mode], use [jakarta.persistence.sharedCache.mode] instead
14-02-2023 12:31:06.184 [main] INFO  SQL dialect.logSelectedDialect - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14-02-2023 12:31:06.781 [main] INFO  org.hibernate.engine.transaction.jta.platform.internal.JtaPlatformInitiator.initiateService - HHH000490: Using JtaPlatform implementation: [org.hibernate.engine.transaction.jta.platform.internal.NoJtaPlatform]
14-02-2023 12:31:06.797 [main] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.buildNativeEntityManagerFactory - Initialized JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 12:31:06.828 [main] INFO  org.axonframework.springboot.autoconfig.XStreamAutoConfiguration.defaultAxonXStream - Initializing an XStream instance since none was found. The auto configuration base packages will be used as wildcards for the XStream security settings.
14-02-2023 12:31:06.906 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [com.example.eventsourcingcqrs].
14-02-2023 12:31:06.906 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.tokenstore].
14-02-2023 12:31:06.906 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventhandling.deadletter.jpa].
14-02-2023 12:31:06.906 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.modelling.saga.repository.jpa].
14-02-2023 12:31:06.906 [main] INFO  org.axonframework.springboot.util.XStreamSecurityTypeUtility.lambda$autoConfigBasePackages$0 - Constructing wildcard type for base package [org.axonframework.eventsourcing.eventstore.jpa].
14-02-2023 12:31:06.922 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.Dom4JToByteArrayConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 12:31:06.922 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToDom4jConverter] is ignored. It seems to rely on a class that is not available in the class loader: org/dom4j/Document
14-02-2023 12:31:06.922 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.XomToStringConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 12:31:06.922 [main] INFO  org.axonframework.serialization.ChainingConverter.registerConverter - ContentTypeConverter of type [class org.axonframework.serialization.xml.InputStreamToXomConverter] is ignored. It seems to rely on a class that is not available in the class loader: nu/xom/Document
14-02-2023 12:31:07.110 [main] WARN  org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration$JpaWebConfiguration.openEntityManagerInViewInterceptor - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
14-02-2023 12:31:07.408 [main] INFO  org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver.<init> - Exposing 1 endpoint(s) beneath base path '/actuator'
14-02-2023 12:31:07.456 [main] INFO  org.apache.coyote.http11.Http11NioProtocol.log - Starting ProtocolHandler ["http-nio-9090"]
14-02-2023 12:31:07.471 [main] INFO  org.springframework.boot.web.embedded.tomcat.TomcatWebServer.start - Tomcat started on port(s): 9090 (http) with context path ''
14-02-2023 12:31:07.518 [main] INFO  com.example.eventsourcingcqrs.EventSourcingCqrsApplication.logStarted - Started EventSourcingCqrsApplication in 3.611 seconds (process running for 4.194)
14-02-2023 12:31:07.771 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.lambda$run$3 - Worker assigned to segment Segment[0/0] for processing
14-02-2023 12:31:07.771 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Using current Thread for last segment worker: TrackingSegmentWorker{processor=com.example.eventsourcingcqrs.query.api.controller.projection, segment=Segment[0/0]}
14-02-2023 12:31:07.771 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.ensureEventStreamOpened - Fetched token: null for segment: Segment[0/0]
14-02-2023 12:33:58.458 [http-nio-9090-exec-9] INFO  org.apache.catalina.core.ContainerBase.[Tomcat].[localhost].[/].log - Initializing Spring DispatcherServlet 'dispatcherServlet'
14-02-2023 12:33:58.458 [http-nio-9090-exec-9] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Initializing Servlet 'dispatcherServlet'
14-02-2023 12:33:58.459 [http-nio-9090-exec-9] INFO  org.springframework.web.servlet.DispatcherServlet.initServletBean - Completed initialization in 1 ms
14-02-2023 12:33:58.499 [http-nio-9090-exec-9] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.<init> - Une commande pour la création d'un nouveau compte bancaire [d0931b04-6f86-44f8-8ac5-973544cd7ba1] a été effectué.
14-02-2023 12:33:58.502 [http-nio-9090-exec-9] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°d0931b04-6f86-44f8-8ac5-973544cd7ba1 est en cours...
14-02-2023 12:33:58.504 [http-nio-9090-exec-9] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°d0931b04-6f86-44f8-8ac5-973544cd7ba1 est en cours...
14-02-2023 12:33:58.557 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] DEBUG com.example.eventsourcingcqrs.query.api.controller.projection.ProjectionBankAccountService.createBankAccount - Création en base du compte n°d0931b04-6f86-44f8-8ac5-973544cd7ba1.
14-02-2023 12:33:58.571 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] DEBUG com.example.eventsourcingcqrs.query.api.controller.projection.ProjectionBankAccountService.createBankAccount - Sauvegarde en base du compte n°d0931b04-6f86-44f8-8ac5-973544cd7ba1.
14-02-2023 12:33:58.580 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] DEBUG com.example.eventsourcingcqrs.query.api.controller.projection.ProjectionBankAccountService.activateBankAccount - Activation du compte en cours...
14-02-2023 12:33:58.582 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] DEBUG com.example.eventsourcingcqrs.query.api.controller.projection.ProjectionBankAccountService.activateBankAccount - Compte n°d0931b04-6f86-44f8-8ac5-973544cd7ba1 activé, sauvegarde en base du nouveau statut.
14-02-2023 12:37:59.133 [http-nio-9090-exec-7] DEBUG com.example.eventsourcingcqrs.query.api.controller.projection.ProjectionBankAccountService.findBankAccountById - Rechercher un compte bancaire par son ID.
14-02-2023 12:37:59.134 [http-nio-9090-exec-7] DEBUG com.example.eventsourcingcqrs.query.api.controller.projection.ProjectionBankAccountService.findBankAccountById - Compte bancaire trouver.
14-02-2023 12:40:01.406 [http-nio-9090-exec-6] WARN  org.springframework.core.annotation.AnnotationTypeMapping.addConventionMappings - Support for convention-based annotation attribute overrides is deprecated and will be removed in Spring Framework 6.1. Please annotate the following attributes in @org.axonframework.modelling.command.AggregateIdentifier with appropriate @AliasFor declarations: [routingKey]
14-02-2023 12:40:01.407 [http-nio-9090-exec-6] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°d0931b04-6f86-44f8-8ac5-973544cd7ba1 est en cours...
14-02-2023 12:40:01.408 [http-nio-9090-exec-6] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°d0931b04-6f86-44f8-8ac5-973544cd7ba1 est en cours...
14-02-2023 12:40:01.411 [http-nio-9090-exec-6] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - Une commande pour un dépôt d'argent d'un montant de 20000 sur le compte bancaire n°d0931b04-6f86-44f8-8ac5-973544cd7ba1 a été effectué.
14-02-2023 12:40:01.411 [http-nio-9090-exec-6] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - Une demande de dépôt d'argent sur le compte bancaire n°d0931b04-6f86-44f8-8ac5-973544cd7ba1 est en cours...
14-02-2023 12:40:01.415 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] DEBUG com.example.eventsourcingcqrs.query.api.controller.projection.ProjectionBankAccountService.depositMoneyInBankAccount - Ajout en base d'un dépôt d'argent d'un montant de 20000 sur le compte.
14-02-2023 12:40:01.415 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] DEBUG com.example.eventsourcingcqrs.query.api.controller.projection.ProjectionBankAccountService.depositMoneyInBankAccount - Sauvegarde en base du nouveau solde suite au dépôt effectué sur le compte n°d0931b04-6f86-44f8-8ac5-973544cd7ba1.
14-02-2023 12:40:06.143 [http-nio-9090-exec-4] DEBUG com.example.eventsourcingcqrs.query.api.controller.projection.ProjectionBankAccountService.findBankAccountById - Rechercher un compte bancaire par son ID.
14-02-2023 12:40:06.144 [http-nio-9090-exec-4] DEBUG com.example.eventsourcingcqrs.query.api.controller.projection.ProjectionBankAccountService.findBankAccountById - Compte bancaire trouver.
14-02-2023 12:40:48.264 [http-nio-9090-exec-10] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - La création d'un compte bancaire n°d0931b04-6f86-44f8-8ac5-973544cd7ba1 est en cours...
14-02-2023 12:40:48.265 [http-nio-9090-exec-10] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - Une demande d'activation du compte n°d0931b04-6f86-44f8-8ac5-973544cd7ba1 est en cours...
14-02-2023 12:40:48.265 [http-nio-9090-exec-10] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - Une demande de dépôt d'argent sur le compte bancaire n°d0931b04-6f86-44f8-8ac5-973544cd7ba1 est en cours...
14-02-2023 12:40:48.265 [http-nio-9090-exec-10] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - Une commande pour un retrait d'argent d'un montant de 10000 sur le compte bancaire n°d0931b04-6f86-44f8-8ac5-973544cd7ba1 a été effectué.
14-02-2023 12:40:48.266 [http-nio-9090-exec-10] DEBUG com.example.eventsourcingcqrs.command.api.aggregate.BankAccountAggregate.on - Une demande de retrait sur le compte bancaire n°d0931b04-6f86-44f8-8ac5-973544cd7ba1 est en cours...
14-02-2023 12:40:48.268 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] DEBUG com.example.eventsourcingcqrs.query.api.controller.projection.ProjectionBankAccountService.withdrawalMoneyFromBankAccount - Retrait d'argent en base d'un montant de 10000 sur le compte.
14-02-2023 12:40:48.269 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] DEBUG com.example.eventsourcingcqrs.query.api.controller.projection.ProjectionBankAccountService.withdrawalMoneyFromBankAccount - Sauvegarde en base du nouveau solde suite au retrait effectué sur le compte n°d0931b04-6f86-44f8-8ac5-973544cd7ba1.
14-02-2023 12:40:54.740 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.query.api.controller.projection.ProjectionBankAccountService.findBankAccountById - Rechercher un compte bancaire par son ID.
14-02-2023 12:40:54.740 [http-nio-9090-exec-1] DEBUG com.example.eventsourcingcqrs.query.api.controller.projection.ProjectionBankAccountService.findBankAccountById - Compte bancaire trouver.
14-02-2023 12:41:47.381 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.setShutdownState - Shutdown state set for Processor 'com.example.eventsourcingcqrs.query.api.controller.projection'.
14-02-2023 12:41:47.381 [SpringApplicationShutdownHook] INFO  org.axonframework.eventhandling.TrackingEventProcessor.awaitTermination - Processor 'com.example.eventsourcingcqrs.query.api.controller.projection' awaiting termination...
14-02-2023 12:41:47.744 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 12:41:47.744 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
14-02-2023 12:41:47.760 [EmbeddedEventStore-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 12:41:47.760 [EmbeddedEventStore-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
14-02-2023 12:41:47.763 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Error occurred. Starting retry mode.
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:175)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:709)
	at org.axonframework.eventhandling.tokenstore.jpa.JpaTokenStore.extendClaim(JpaTokenStore.java:232)
	at org.axonframework.eventhandling.TrackingEventProcessor.lambda$processBatch$13(TrackingEventProcessor.java:462)
	at org.axonframework.common.transaction.TransactionManager.executeInTransaction(TransactionManager.java:47)
	at org.axonframework.eventhandling.TrackingEventProcessor.processBatch(TrackingEventProcessor.java:461)
	at org.axonframework.eventhandling.TrackingEventProcessor.processingLoop(TrackingEventProcessor.java:318)
	at org.axonframework.eventhandling.TrackingEventProcessor$TrackingSegmentWorker.run(TrackingEventProcessor.java:1145)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.cleanUp(TrackingEventProcessor.java:1340)
	at org.axonframework.eventhandling.TrackingEventProcessor$WorkerLauncher.run(TrackingEventProcessor.java:1317)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.lambda$executeUpdate$0(SimpleUpdateQueryPlan.java:99)
	at org.hibernate.sql.exec.internal.StandardJdbcMutationExecutor.execute(StandardJdbcMutationExecutor.java:63)
	at org.hibernate.query.sqm.internal.SimpleUpdateQueryPlan.executeUpdate(SimpleUpdateQueryPlan.java:93)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doExecuteUpdate(QuerySqmImpl.java:728)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.executeUpdate(QuerySqmImpl.java:698)
	... 9 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set timestamp=? where processor_name=? and segment=? and owner=? [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTableOrView(Parser.java:8328)
	at org.h2.command.Parser.readSimpleTableFilter(Parser.java:1160)
	at org.h2.command.Parser.parseUpdate(Parser.java:1118)
	at org.h2.command.Parser.parsePrepared(Parser.java:858)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 15 common frames omitted
14-02-2023 12:41:47.763 [EmbeddedEventStore-0] ERROR org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.fetchData - Failed to read events from the underlying event storage
jakarta.persistence.PersistenceException: Converting `org.hibernate.exception.SQLGrammarException` to JPA `PersistenceException` : could not prepare statement
	at org.hibernate.internal.ExceptionConverterImpl.convert(ExceptionConverterImpl.java:165)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:374)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.list(QuerySqmImpl.java:1073)
	at org.hibernate.query.Query.getResultList(Query.java:94)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchEvents(JpaEventStorageEngine.java:181)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.lambda$fetchTrackedEvents$1(JpaEventStorageEngine.java:194)
	at org.axonframework.common.transaction.TransactionManager.fetchInTransaction(TransactionManager.java:70)
	at org.axonframework.eventsourcing.eventstore.jpa.JpaEventStorageEngine.fetchTrackedEvents(JpaEventStorageEngine.java:194)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine.lambda$readEventData$1(BatchingEventStorageEngine.java:148)
	at org.axonframework.eventsourcing.eventstore.BatchingEventStorageEngine$EventStreamSpliterator.tryAdvance(BatchingEventStorageEngine.java:289)
	at java.base/java.util.Spliterator.forEachRemaining(Spliterator.java:332)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.fetchData(EmbeddedEventStore.java:261)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.run(EmbeddedEventStore.java:227)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore$EventProducer.access$2800(EmbeddedEventStore.java:204)
	at org.axonframework.eventsourcing.eventstore.EmbeddedEventStore.lambda$ensureProducerStarted$0(EmbeddedEventStore.java:148)
	at java.base/java.lang.Thread.run(Thread.java:833)
Caused by: org.hibernate.exception.SQLGrammarException: could not prepare statement
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:64)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:56)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:109)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:186)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl.prepareStatement(StatementPreparerImpl.java:75)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.lambda$list$0(JdbcSelectExecutorStandardImpl.java:100)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.executeQuery(DeferredResultSetAccess.java:171)
	at org.hibernate.sql.results.jdbc.internal.DeferredResultSetAccess.getResultSet(DeferredResultSetAccess.java:146)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.advanceNext(JdbcValuesResultSetImpl.java:205)
	at org.hibernate.sql.results.jdbc.internal.JdbcValuesResultSetImpl.processNext(JdbcValuesResultSetImpl.java:85)
	at org.hibernate.sql.results.jdbc.internal.AbstractJdbcValues.next(AbstractJdbcValues.java:29)
	at org.hibernate.sql.results.internal.RowProcessingStateStandardImpl.next(RowProcessingStateStandardImpl.java:88)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:197)
	at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:33)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorStandardImpl.java:443)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorStandardImpl.java:166)
	at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.list(JdbcSelectExecutorStandardImpl.java:91)
	at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:31)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.lambda$new$0(ConcreteSqmSelectQueryPlan.java:113)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.withCacheableSqmInterpretation(ConcreteSqmSelectQueryPlan.java:335)
	at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.performList(ConcreteSqmSelectQueryPlan.java:276)
	at org.hibernate.query.sqm.internal.QuerySqmImpl.doList(QuerySqmImpl.java:571)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:363)
	... 20 common frames omitted
Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException: Table "DOMAIN_EVENT_ENTRY" not found (this database is empty); SQL statement:
select d1_0.global_index,d1_0.type,d1_0.aggregate_identifier,d1_0.sequence_number,d1_0.event_identifier,d1_0.time_stamp,d1_0.payload_type,d1_0.payload_revision,d1_0.payload,d1_0.meta_data from domain_event_entry d1_0 where d1_0.global_index>? order by d1_0.global_index asc fetch first ? rows only [42104-214]
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:502)
	at org.h2.message.DbException.getJdbcSQLException(DbException.java:477)
	at org.h2.message.DbException.get(DbException.java:223)
	at org.h2.message.DbException.get(DbException.java:199)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8385)
	at org.h2.command.Parser.getTableOrViewNotFoundDbException(Parser.java:8369)
	at org.h2.command.Parser.readTableOrView(Parser.java:8358)
	at org.h2.command.Parser.readTablePrimary(Parser.java:1863)
	at org.h2.command.Parser.readTableReference(Parser.java:2334)
	at org.h2.command.Parser.parseSelectFromPart(Parser.java:2772)
	at org.h2.command.Parser.parseSelect(Parser.java:2878)
	at org.h2.command.Parser.parseQueryPrimary(Parser.java:2762)
	at org.h2.command.Parser.parseQueryTerm(Parser.java:2633)
	at org.h2.command.Parser.parseQueryExpressionBody(Parser.java:2612)
	at org.h2.command.Parser.parseQueryExpressionBodyAndEndOfQuery(Parser.java:2605)
	at org.h2.command.Parser.parseQueryExpression(Parser.java:2598)
	at org.h2.command.Parser.parseQuery(Parser.java:2567)
	at org.h2.command.Parser.parsePrepared(Parser.java:724)
	at org.h2.command.Parser.parse(Parser.java:689)
	at org.h2.command.Parser.parse(Parser.java:661)
	at org.h2.command.Parser.prepareCommand(Parser.java:569)
	at org.h2.engine.SessionLocal.prepareLocal(SessionLocal.java:631)
	at org.h2.engine.SessionLocal.prepareCommand(SessionLocal.java:554)
	at org.h2.jdbc.JdbcConnection.prepareCommand(JdbcConnection.java:1116)
	at org.h2.jdbc.JdbcPreparedStatement.<init>(JdbcPreparedStatement.java:92)
	at org.h2.jdbc.JdbcConnection.prepareStatement(JdbcConnection.java:288)
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:327)
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$1.doPrepare(StatementPreparerImpl.java:90)
	at org.hibernate.engine.jdbc.internal.StatementPreparerImpl$StatementPreparationTemplate.prepareStatement(StatementPreparerImpl.java:176)
	... 39 common frames omitted
14-02-2023 12:41:47.764 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] WARN  org.axonframework.eventhandling.TrackingEventProcessor.processingLoop - Releasing claim on token and preparing for retry in 1s
14-02-2023 12:41:47.764 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 12:41:47.764 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 12:41:47.764 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 12:41:47.764 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] WARN  org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - SQL Error: 42104, SQLState: 42S04
14-02-2023 12:41:47.764 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] ERROR org.hibernate.engine.jdbc.spi.SqlExceptionHelper.logExceptions - Table "TOKEN_ENTRY" not found (this database is empty); SQL statement:
update token_entry set owner=null where owner=? and processor_name=? and segment=? [42104-214]
14-02-2023 12:41:47.764 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.releaseToken - Release claim failed
14-02-2023 12:41:47.764 [EventProcessor[com.example.eventsourcingcqrs.query.api.controller.projection]-0] INFO  org.axonframework.eventhandling.TrackingEventProcessor.cleanUp - Worker for segment Segment[0/0] stopped.
14-02-2023 12:41:47.780 [SpringApplicationShutdownHook] INFO  org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.destroy - Closing JPA EntityManagerFactory for persistence unit 'default'
14-02-2023 12:41:47.780 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown initiated...
14-02-2023 12:41:47.795 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource.close - HikariPool-1 - Shutdown completed.
